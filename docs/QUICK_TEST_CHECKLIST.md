# ğŸš€ å¿«é€Ÿæµ‹è¯•æ¸…å•

## ğŸ“‹ ä¿®å¤å†…å®¹æ€»ç»“

### âœ… å·²ä¿®å¤çš„é—®é¢˜

1. **WebSocket æ¶ˆæ¯åè®®ä¸åŒ¹é…**
   - è¿æ¥å‘½ä»¤: `drone_connect` â†’ `connect`
   - è§†é¢‘å‘½ä»¤: `start_video_streaming` â†’ `start_video`

2. **å“åº”æ•°æ®æ ¼å¼ç»Ÿä¸€**
   - æ‰€æœ‰å“åº”æ•°æ®æ”¾åœ¨ `data` å­—æ®µä¸­
   - è§†é¢‘å¸§åŒ…å«å®Œæ•´å…ƒæ•°æ®

3. **VideoControlPanel ç±»å‹ä¿®å¤**
   - æ­£ç¡®çš„ `VideoStreamState` æ¥å£
   - æ˜¾ç¤ºå®æ—¶ FPS å’ŒæµçŠ¶æ€

4. **å¢å¼ºçš„è°ƒè¯•æ—¥å¿—**
   - åç«¯å®Œæ•´çš„å‘½ä»¤è¿½è¸ª
   - å‰ç«¯çŠ¶æ€å˜åŒ–æ—¥å¿—

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### å‡†å¤‡å·¥ä½œ

```bash
# 1. ç¡®ä¿ Tello WiFi å·²è¿æ¥
# WiFi åç§°: TELLO-XXXXXX

# 2. å¯åŠ¨åç«¯
cd drone-analyzer-nextjs/python
python unified_drone_backend.py

# 3. å¯åŠ¨å‰ç«¯
cd drone-analyzer-nextjs
npm run dev

# 4. æ‰“å¼€æµè§ˆå™¨
# http://localhost:3000
```

### æµ‹è¯• 1: WebSocket è¿æ¥

**æ­¥éª¤**:
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. åˆ‡æ¢åˆ° Network æ ‡ç­¾
3. ç­›é€‰ WS (WebSocket)
4. åˆ·æ–°é¡µé¢

**æœŸæœ›ç»“æœ**:
- [ ] çœ‹åˆ° `ws://localhost:3002` è¿æ¥
- [ ] Status: 101 (Switching Protocols)
- [ ] ç»¿è‰²å›¾æ ‡è¡¨ç¤ºè¿æ¥æ´»è·ƒ

**åç«¯æ—¥å¿—**:
```
âœ“ å®¢æˆ·ç«¯è¿æ¥: XXXXX
```

### æµ‹è¯• 2: Tello è¿æ¥

**æ­¥éª¤**:
1. ç‚¹å‡» "è¿æ¥æ— äººæœº" æŒ‰é’®
2. è§‚å¯Ÿåç«¯æ—¥å¿—
3. è§‚å¯Ÿå‰ç«¯æ—¥å¿—é¢æ¿

**æœŸæœ›ç»“æœ**:

**åç«¯æ—¥å¿—åº”æ˜¾ç¤º**:
```
ğŸ“© æ”¶åˆ°åŸå§‹æ¶ˆæ¯: {"command":"connect"}
ğŸ“¨ æ”¶åˆ°å‘½ä»¤: connect
ğŸ”Œ æ‰§è¡Œè¿æ¥å‘½ä»¤...
ğŸ”„ æ”¶åˆ°è¿æ¥è¯·æ±‚...
ğŸ“¡ æ­£åœ¨åˆ›å»º Tello å®ä¾‹...
ğŸ“¡ æ­£åœ¨è¿æ¥ Tello æ— äººæœº...
   âš ï¸ ç¡®ä¿å·²è¿æ¥åˆ° Tello WiFi (TELLO-XXXXXX)
âœ… Tello æ— äººæœºè¿æ¥æˆåŠŸï¼
   - ç”µæ± ç”µé‡: XX%
ğŸ“¤ å‘é€å“åº”: {...}
```

**å‰ç«¯æ—¥å¿—é¢æ¿åº”æ˜¾ç¤º**:
```
[INFO] æ­£åœ¨è¿æ¥æ— äººæœº...
[INFO] WebSocketè¿æ¥æˆåŠŸï¼Œå‘é€æ— äººæœºè¿æ¥å‘½ä»¤...
[SUCCESS] æ— äººæœºè¿æ¥æˆåŠŸ
```

**UI å˜åŒ–**:
- [ ] è¿æ¥æŒ‰é’®å˜ä¸º "æ–­å¼€è¿æ¥"
- [ ] ç”µæ± å›¾æ ‡æ˜¾ç¤ºç”µé‡
- [ ] çŠ¶æ€æŒ‡ç¤ºå™¨å˜ç»¿

### æµ‹è¯• 3: è§†é¢‘æµå¯åŠ¨

**æ­¥éª¤**:
è¿æ¥æˆåŠŸåï¼Œè§†é¢‘æµåº”è‡ªåŠ¨å¯åŠ¨

**æœŸæœ›ç»“æœ**:

**åç«¯æ—¥å¿—åº”æ˜¾ç¤º**:
```
ğŸ“¨ æ”¶åˆ°å‘½ä»¤: start_video
âœ… è§†é¢‘æµå·²å¯åŠ¨
ğŸ¥ è§†é¢‘å¤„ç†çº¿ç¨‹å¯åŠ¨
```

**å‰ç«¯å˜åŒ–**:
- [ ] ä¸»ç”»é¢æ˜¾ç¤ºæ— äººæœºæ‘„åƒå¤´è§†é¢‘
- [ ] VideoControlPanel æ˜¾ç¤º "ç›´æ’­ XX FPS"
- [ ] è§†é¢‘æµç•…ï¼Œæ— æ˜æ˜¾å»¶è¿Ÿ

**æµè§ˆå™¨ Network æ ‡ç­¾**:
- [ ] æŒç»­æ”¶åˆ° `video_frame` æ¶ˆæ¯
- [ ] æ¶ˆæ¯åŒ…å« Base64 å›¾åƒæ•°æ®

### æµ‹è¯• 4: è§†é¢‘æ§åˆ¶é¢æ¿çŠ¶æ€

**æ£€æŸ¥é¡¹**:
- [ ] å³ä¸Šè§’æ˜¾ç¤º "ç›´æ’­ XX FPS" chip (ç»¿è‰²ï¼Œé—ªçƒ)
- [ ] å½•åˆ¶æŒ‰é’®å¯ç”¨
- [ ] æˆªå›¾æŒ‰é’®å¯ç”¨
- [ ] æ‰€æœ‰æ§åˆ¶é¡¹å“åº”æ­£ç¡®

### æµ‹è¯• 5: æ–­å¼€è¿æ¥

**æ­¥éª¤**:
1. ç‚¹å‡» "æ–­å¼€è¿æ¥" æŒ‰é’®
2. è§‚å¯ŸçŠ¶æ€å˜åŒ–

**æœŸæœ›ç»“æœ**:
- [ ] è§†é¢‘æµåœæ­¢
- [ ] "ç›´æ’­" chip æ¶ˆå¤±
- [ ] ç”»é¢æ˜¾ç¤º "Connect to drone to view stream"
- [ ] è¿æ¥æŒ‰é’®æ¢å¤ä¸º "è¿æ¥æ— äººæœº"

## ğŸ› å¦‚æœæµ‹è¯•å¤±è´¥

### å¤±è´¥åœºæ™¯ 1: WebSocket è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: Network æ ‡ç­¾æ²¡æœ‰ WS è¿æ¥

**è§£å†³**:
```bash
# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
netstat -ano | findstr 3002

# é‡å¯åç«¯
python unified_drone_backend.py
```

### å¤±è´¥åœºæ™¯ 2: Tello è¿æ¥è¶…æ—¶

**ç—‡çŠ¶**: 
```
âŒ Tello è¿æ¥å¤±è´¥: Timed out waiting for response
```

**è§£å†³**:
```bash
# 1. æ£€æŸ¥ WiFi è¿æ¥
netsh wlan show interfaces | findstr "TELLO"

# 2. å¦‚æœæœªè¿æ¥ï¼Œè¿æ¥åˆ° Tello WiFi

# 3. æµ‹è¯•ç½‘ç»œ
ping 192.168.10.1

# 4. é‡è¯•è¿æ¥
```

### å¤±è´¥åœºæ™¯ 3: è§†é¢‘æµä¸å¯åŠ¨

**ç—‡çŠ¶**: è¿æ¥æˆåŠŸï¼Œä½†è§†é¢‘åŒºåŸŸæ˜¾ç¤º "Waiting for video stream..."

**è°ƒè¯•æ­¥éª¤**:

1. **æ£€æŸ¥åç«¯æ—¥å¿—**ï¼Œåº”è¯¥çœ‹åˆ°:
   ```
   ğŸ“¨ æ”¶åˆ°å‘½ä»¤: start_video
   âœ… è§†é¢‘æµå·²å¯åŠ¨
   ```

2. **å¦‚æœæ²¡æœ‰**ï¼Œæ‰‹åŠ¨å‘é€å‘½ä»¤:
   ```javascript
   // æµè§ˆå™¨æ§åˆ¶å°
   const ws = new WebSocket('ws://localhost:3002');
   ws.onopen = () => {
     ws.send(JSON.stringify({ command: 'start_video' }));
   };
   ws.onmessage = (e) => {
     const data = JSON.parse(e.data);
     console.log('Response:', data);
     if (data.type === 'video_frame') {
       console.log('Video frame received!', data.data.fps);
     }
   };
   ```

3. **æ£€æŸ¥ Tello æ‘„åƒå¤´**:
   ```python
   # python
   from djitellopy import Tello
   tello = Tello()
   tello.connect()
   tello.streamon()
   frame = tello.get_frame_read().frame
   print(f"Frame: {frame.shape if frame is not None else 'None'}")
   tello.streamoff()
   tello.end()
   ```

### å¤±è´¥åœºæ™¯ 4: è§†é¢‘å»¶è¿Ÿä¸¥é‡

**ä¼˜åŒ–æ–¹æ¡ˆ**:

1. **é™ä½å¸§ç‡** (åç«¯ `unified_drone_backend.py`)
   ```python
   # ç¬¬567è¡Œ
   time.sleep(0.05)  # 20 FPS (åŸ 0.03 = 30 FPS)
   ```

2. **é™ä½ JPEG è´¨é‡** (åç«¯)
   ```python
   # ç¬¬539è¡Œ
   cv2.imencode('.jpg', processed_frame, [cv2.IMWRITE_JPEG_QUALITY, 60])
   ```

3. **å…³é—­æ£€æµ‹** (å‰ç«¯)
   ```javascript
   // åœ¨ useDroneControl ä¸­
   sendMessage('set_detection_mode', { mode: 'none' });
   ```

## âœ… å®Œæ•´åŠŸèƒ½éªŒè¯

æ‰€æœ‰åŠŸèƒ½æ­£å¸¸çš„æ ‡å¿—ï¼š

### è¿æ¥åŠŸèƒ½
- [ ] WebSocket è¿æ¥æˆåŠŸ
- [ ] Tello è¿æ¥æˆåŠŸ
- [ ] ç”µæ± ä¿¡æ¯æ˜¾ç¤ºæ­£ç¡®
- [ ] çŠ¶æ€åŒæ­¥æ­£å¸¸

### è§†é¢‘åŠŸèƒ½
- [ ] è§†é¢‘æµè‡ªåŠ¨å¯åŠ¨
- [ ] ç”»é¢æµç•…æ˜¾ç¤º
- [ ] FPS æ˜¾ç¤ºæ­£å¸¸ (15-30)
- [ ] VideoControlPanel çŠ¶æ€æ­£ç¡®

### æ§åˆ¶åŠŸèƒ½
- [ ] èµ·é£/é™è½æŒ‰é’®å“åº”
- [ ] å½•åˆ¶åŠŸèƒ½æ­£å¸¸
- [ ] æˆªå›¾åŠŸèƒ½æ­£å¸¸
- [ ] æ‰‹åŠ¨æ§åˆ¶å“åº”

### æ£€æµ‹åŠŸèƒ½ (å¦‚æœå¯ç”¨)
- [ ] YOLO æ£€æµ‹æ­£å¸¸
- [ ] QR ç æ£€æµ‹æ­£å¸¸
- [ ] æ£€æµ‹ç»“æœæ˜¾ç¤º

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### æ­£å¸¸èŒƒå›´
- **WebSocket å»¶è¿Ÿ**: < 50ms
- **è§†é¢‘ FPS**: 15-30
- **è§†é¢‘å»¶è¿Ÿ**: < 500ms
- **å‘½ä»¤å“åº”**: < 200ms

### ç›‘æ§æ–¹æ³•

**æµè§ˆå™¨æ§åˆ¶å°**:
```javascript
// ç›‘æ§ WebSocket æ¶ˆæ¯
let lastFrameTime = 0;
const ws = new WebSocket('ws://localhost:3002');
ws.onmessage = (e) => {
  const data = JSON.parse(e.data);
  if (data.type === 'video_frame') {
    const now = Date.now();
    const delay = lastFrameTime ? now - lastFrameTime : 0;
    console.log(`Frame delay: ${delay}ms, FPS: ${data.data.fps}`);
    lastFrameTime = now;
  }
};
```

**åç«¯ç›‘æ§**:
```python
# unified_drone_backend.py
# å·²æœ‰ FPS è®¡ç®—é€»è¾‘ (ç¬¬531-536è¡Œ)
```

## ğŸ“ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```markdown
## æµ‹è¯•ç»“æœ

**æ—¥æœŸ**: YYYY-MM-DD
**æµ‹è¯•äºº**: XXX
**ç¯å¢ƒ**: Windows 10 / macOS / Linux

### è¿æ¥æµ‹è¯•
- [ ] WebSocket è¿æ¥: âœ…/âŒ
- [ ] Tello è¿æ¥: âœ…/âŒ  
- [ ] ç”µæ± æ˜¾ç¤º: âœ…/âŒ

### è§†é¢‘æµ‹è¯•
- [ ] è§†é¢‘å¯åŠ¨: âœ…/âŒ
- [ ] è§†é¢‘æ˜¾ç¤º: âœ…/âŒ
- [ ] FPS: XX
- [ ] å»¶è¿Ÿ: XX ms

### æ§åˆ¶æµ‹è¯•
- [ ] èµ·é£/é™è½: âœ…/âŒ
- [ ] å½•åˆ¶: âœ…/âŒ
- [ ] æˆªå›¾: âœ…/âŒ

### é—®é¢˜è®°å½•
1. [æè¿°é—®é¢˜]
2. [æè¿°é—®é¢˜]

### æ—¥å¿—æˆªå›¾
[é™„ä¸Šå…³é”®æ—¥å¿—æˆªå›¾]
```

---

**æµ‹è¯•å®Œæˆå**ï¼Œå¦‚æœæ‰€æœ‰é¡¹ç›®é€šè¿‡ï¼Œç³»ç»Ÿå·²å®Œå…¨ä¿®å¤ï¼ ğŸ‰


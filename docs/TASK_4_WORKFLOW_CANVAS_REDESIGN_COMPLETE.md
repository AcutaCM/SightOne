# Task 4: å·¥ä½œæµç”»å¸ƒé‡æ–°è®¾è®¡ - å®Œæˆæ€»ç»“

## æ¦‚è¿°

ä»»åŠ¡ 4 "é‡æ–°è®¾è®¡å·¥ä½œæµç”»å¸ƒ" å·²æˆåŠŸå®Œæˆã€‚æœ¬ä»»åŠ¡å®ç°äº†ä¸€ä¸ªç°ä»£åŒ–ã€ä¸“ä¸šçš„å·¥ä½œæµç”»å¸ƒç»„ä»¶ï¼Œå…·æœ‰å®Œæ•´çš„ä¸»é¢˜æ”¯æŒã€æµç•…çš„äº¤äº’ä½“éªŒå’Œå¼ºå¤§çš„å¯¹é½è¾…åŠ©åŠŸèƒ½ã€‚

## å®Œæˆçš„å­ä»»åŠ¡

### âœ… 4.1 åˆ›å»ºç”»å¸ƒå®¹å™¨ç»„ä»¶

**å®ç°æ–‡ä»¶:**
- `components/workflow/WorkflowCanvas.tsx` - ä¸»ç”»å¸ƒç»„ä»¶
- `styles/WorkflowCanvas.module.css` - ç”»å¸ƒæ ·å¼

**åŠŸèƒ½ç‰¹æ€§:**
- âœ… é›†æˆ React Flow ä½œä¸ºç”»å¸ƒå¼•æ“
- âœ… å®Œæ•´çš„ä¸»é¢˜ç³»ç»Ÿæ”¯æŒï¼ˆæ˜æš—ä¸»é¢˜ï¼‰
- âœ… å“åº”å¼å¸ƒå±€è®¾è®¡
- âœ… è‡ªå®šä¹‰èŠ‚ç‚¹ç±»å‹æ”¯æŒ
- âœ… æ‹–æ”¾èŠ‚ç‚¹åˆ›å»ºåŠŸèƒ½
- âœ… å¹³æ»‘çš„åŠ¨ç”»è¿‡æ¸¡æ•ˆæœ

**æŠ€æœ¯å®ç°:**
```typescript
// ä¸»è¦ç‰¹æ€§
- React Flow é›†æˆ
- useWorkflowTheme hook ä¸»é¢˜ç®¡ç†
- è‡ªå®šä¹‰ CSS å˜é‡ç³»ç»Ÿ
- å“åº”å¼å®¹å™¨è®¾è®¡
```

### âœ… 4.2 å®ç°ç”»å¸ƒèƒŒæ™¯å’Œç½‘æ ¼

**å®ç°æ–‡ä»¶:**
- `components/workflow/WorkflowCanvas.tsx` (Background ç»„ä»¶)
- `hooks/useWorkflowTheme.ts` (å¢å¼ºç‰ˆ)

**åŠŸèƒ½ç‰¹æ€§:**
- âœ… ç‚¹çŠ¶ç½‘æ ¼èƒŒæ™¯ï¼ˆ20px é—´è·ï¼‰
- âœ… æ˜æš—ä¸»é¢˜è‡ªåŠ¨åˆ‡æ¢
- âœ… ç½‘æ ¼é¢œè‰²ä¸»é¢˜é€‚é…
- âœ… å¹³æ»‘çš„ä¸»é¢˜è¿‡æ¸¡åŠ¨ç”»ï¼ˆ300msï¼‰

**ä¸»é¢˜é…ç½®:**
```typescript
// æ˜äº®ä¸»é¢˜
canvas: {
  background: '#f8fafc',
  grid: '#e2e8f0',
  gridDot: '#cbd5e1',
}

// æš—é»‘ä¸»é¢˜
canvas: {
  background: '#0a0f1e',
  grid: '#1e293b',
  gridDot: '#334155',
}
```

### âœ… 4.3 å®ç°ç”»å¸ƒäº¤äº’åŠŸèƒ½

**å®ç°æ–‡ä»¶:**
- `components/workflow/WorkflowCanvas.tsx` (äº¤äº’é€»è¾‘)
- `styles/WorkflowCanvas.module.css` (äº¤äº’æ ·å¼)

**åŠŸèƒ½ç‰¹æ€§:**
- âœ… é¼ æ ‡æ»šè½®ç¼©æ”¾ï¼ˆ0.5x - 2xï¼‰
- âœ… ç©ºæ ¼é”® + æ‹–æ‹½å¹³ç§»
- âœ… ç¼©æ”¾å’Œå¹³ç§»åŠ¨ç”»ï¼ˆ300ms ease-outï¼‰
- âœ… è§†è§‰åé¦ˆï¼ˆå…‰æ ‡å˜åŒ–ï¼‰
- âœ… å¤šé€‰æ”¯æŒï¼ˆCtrl + ç‚¹å‡»ï¼‰

**äº¤äº’é…ç½®:**
```typescript
// ç¼©æ”¾èŒƒå›´
minZoom: 0.5
maxZoom: 2.0

// äº¤äº’è®¾ç½®
zoomOnScroll: true
panOnDrag: true (ç©ºæ ¼é”®æ¿€æ´»)
selectionOnDrag: true
```

### âœ… 4.4 å®ç°ç”»å¸ƒå·¥å…·æ 

**å®ç°æ–‡ä»¶:**
- `components/workflow/CanvasToolbar.tsx` - å·¥å…·æ ç»„ä»¶
- `styles/CanvasToolbar.module.css` - å·¥å…·æ æ ·å¼

**åŠŸèƒ½ç‰¹æ€§:**
- âœ… ç¼©æ”¾æ§åˆ¶æŒ‰é’®ï¼ˆæ”¾å¤§/ç¼©å°ï¼‰
- âœ… å®æ—¶ç¼©æ”¾æ¯”ä¾‹æ˜¾ç¤º
- âœ… é€‚åº”è§†å›¾æŒ‰é’®
- âœ… é‡ç½®è§†å›¾æŒ‰é’®
- âœ… å“åº”å¼è®¾è®¡
- âœ… è§¦æ‘¸è®¾å¤‡ä¼˜åŒ–

**å·¥å…·æ æŒ‰é’®:**
```
ğŸ”- ç¼©å° (Zoom Out)
ğŸ“Š 100% ç¼©æ”¾æ¯”ä¾‹æ˜¾ç¤º
ğŸ”+ æ”¾å¤§ (Zoom In)
---
ğŸ“ é€‚åº”è§†å›¾ (Fit View)
ğŸ”„ é‡ç½®è§†å›¾ (Reset View)
```

### âœ… 4.5 å®ç°èŠ‚ç‚¹å¯¹é½è¾…åŠ©

**å®ç°æ–‡ä»¶:**
- `lib/workflow/alignmentHelper.ts` - å¯¹é½è¾…åŠ©é€»è¾‘
- `components/workflow/AlignmentLines.tsx` - å¯¹é½çº¿ç»„ä»¶
- `components/workflow/AlignmentToolbar.tsx` - å¯¹é½å·¥å…·æ 
- `styles/AlignmentLines.module.css` - å¯¹é½çº¿æ ·å¼
- `styles/AlignmentToolbar.module.css` - å¯¹é½å·¥å…·æ æ ·å¼

**åŠŸèƒ½ç‰¹æ€§:**
- âœ… æ‹–æ‹½æ—¶çš„å¸é™„è¾…åŠ©çº¿
- âœ… è‡ªåŠ¨å¯¹é½æ£€æµ‹ï¼ˆ10px é˜ˆå€¼ï¼‰
- âœ… æ‰‹åŠ¨å¯¹é½å·¥å…·æ 
- âœ… èŠ‚ç‚¹åˆ†å¸ƒåŠŸèƒ½
- âœ… å¤šé€‰èŠ‚ç‚¹æ‰¹é‡å¯¹é½

**å¯¹é½åŠŸèƒ½:**
```
æ°´å¹³å¯¹é½:
- å·¦å¯¹é½
- æ°´å¹³å±…ä¸­
- å³å¯¹é½

å‚ç›´å¯¹é½:
- é¡¶éƒ¨å¯¹é½
- å‚ç›´å±…ä¸­
- åº•éƒ¨å¯¹é½

åˆ†å¸ƒåŠŸèƒ½:
- æ°´å¹³å‡åŒ€åˆ†å¸ƒ
- å‚ç›´å‡åŒ€åˆ†å¸ƒ
```

## æŠ€æœ¯æ¶æ„

### ç»„ä»¶å±‚æ¬¡ç»“æ„

```
WorkflowCanvas (ä¸»å®¹å™¨)
â”œâ”€â”€ ReactFlow (ç”»å¸ƒå¼•æ“)
â”‚   â”œâ”€â”€ Background (ç½‘æ ¼èƒŒæ™¯)
â”‚   â”œâ”€â”€ Controls (å†…ç½®æ§åˆ¶å™¨)
â”‚   â”œâ”€â”€ MiniMap (å°åœ°å›¾)
â”‚   â””â”€â”€ CustomNodes (è‡ªå®šä¹‰èŠ‚ç‚¹)
â”œâ”€â”€ CanvasToolbar (ç”»å¸ƒå·¥å…·æ )
â”œâ”€â”€ AlignmentToolbar (å¯¹é½å·¥å…·æ )
â””â”€â”€ AlignmentLines (å¯¹é½è¾…åŠ©çº¿)
```

### ä¸»é¢˜ç³»ç»Ÿé›†æˆ

```typescript
// ä½¿ç”¨ useWorkflowTheme hook
const { theme, tokens } = useWorkflowTheme();

// è®¿é—®è®¾è®¡ä»¤ç‰Œ
tokens.colors.canvas.background
tokens.colors.node.selectedBorder
tokens.shadows.md
tokens.radius.md
```

### æ€§èƒ½ä¼˜åŒ–

1. **React.useMemo** - ç¼“å­˜é…ç½®å¯¹è±¡
2. **React.useCallback** - ç¨³å®šäº‹ä»¶å¤„ç†å™¨
3. **CSS å˜é‡** - é«˜æ•ˆä¸»é¢˜åˆ‡æ¢
4. **requestAnimationFrame** - å¹³æ»‘åŠ¨ç”»
5. **èŠ‚æµå¤„ç†** - ç¼©æ”¾å’Œå¹³ç§»ä¼˜åŒ–

## æ»¡è¶³çš„éœ€æ±‚

### éœ€æ±‚ 3.1: ç°ä»£åŒ–ç”»å¸ƒè®¾è®¡
- âœ… ç»†è…»çš„ç‚¹çŠ¶ç½‘æ ¼èƒŒæ™¯ï¼ˆ20px é—´è·ï¼‰
- âœ… ä¸“ä¸šçš„è§†è§‰æ•ˆæœ
- âœ… ä¸»é¢˜é€‚é…

### éœ€æ±‚ 3.2: ç¼©æ”¾åŠŸèƒ½
- âœ… é¼ æ ‡æ»šè½®ç¼©æ”¾
- âœ… ç¼©æ”¾èŒƒå›´ 0.5x - 2x
- âœ… å¹³æ»‘åŠ¨ç”»æ•ˆæœ

### éœ€æ±‚ 3.3: å¹³ç§»åŠŸèƒ½
- âœ… ç©ºæ ¼é”® + é¼ æ ‡æ‹–æ‹½
- âœ… è§†è§‰åé¦ˆï¼ˆå…‰æ ‡å˜åŒ–ï¼‰
- âœ… å¹³æ»‘åŠ¨ç”»æ•ˆæœ

### éœ€æ±‚ 3.4: åŠ¨ç”»æ•ˆæœ
- âœ… ç¼©æ”¾åŠ¨ç”»ï¼ˆ300ms ease-outï¼‰
- âœ… å¹³ç§»åŠ¨ç”»ï¼ˆ300ms ease-outï¼‰
- âœ… ä¸»é¢˜åˆ‡æ¢åŠ¨ç”»

### éœ€æ±‚ 3.5: å¯¹é½è¾…åŠ©
- âœ… æ‹–æ‹½æ—¶çš„å¸é™„è¾…åŠ©çº¿
- âœ… è‡ªåŠ¨å¯¹é½æ£€æµ‹
- âœ… è§†è§‰åé¦ˆ

### éœ€æ±‚ 3.6: ç”»å¸ƒå·¥å…·æ 
- âœ… ç¼©æ”¾æ§åˆ¶
- âœ… ç¼©æ”¾æ¯”ä¾‹æ˜¾ç¤º
- âœ… é‡ç½®è§†å›¾æŒ‰é’®

### éœ€æ±‚ 10.2: å¯¹é½å·¥å…·
- âœ… æ‰‹åŠ¨å¯¹é½åŠŸèƒ½
- âœ… èŠ‚ç‚¹åˆ†å¸ƒåŠŸèƒ½
- âœ… æ‰¹é‡æ“ä½œæ”¯æŒ

### éœ€æ±‚ 2.4, 2.5: ä¸»é¢˜é€‚é…
- âœ… æ˜äº®ä¸»é¢˜èƒŒæ™¯
- âœ… æš—é»‘ä¸»é¢˜èƒŒæ™¯
- âœ… å¹³æ»‘ä¸»é¢˜åˆ‡æ¢

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```typescript
import WorkflowCanvas from '@/components/workflow/WorkflowCanvas';

function MyWorkflow() {
  const [nodes, setNodes, onNodesChange] = useNodesState([]);
  const [edges, setEdges, onEdgesChange] = useEdgesState([]);
  
  const onConnect = useCallback(
    (params) => setEdges((eds) => addEdge(params, eds)),
    [setEdges]
  );

  return (
    <WorkflowCanvas
      nodes={nodes}
      edges={edges}
      onNodesChange={onNodesChange}
      onEdgesChange={onEdgesChange}
      onConnect={onConnect}
    />
  );
}
```

### è‡ªå®šä¹‰é…ç½®

```typescript
<WorkflowCanvas
  nodes={nodes}
  edges={edges}
  onNodesChange={onNodesChange}
  onEdgesChange={onEdgesChange}
  onConnect={onConnect}
  nodeTypes={customNodeTypes}
  onNodeDoubleClick={handleNodeDoubleClick}
  className="custom-canvas"
/>
```

## æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

1. **ç»„ä»¶æ–‡ä»¶:**
   - `components/workflow/WorkflowCanvas.tsx` (ä¸»ç”»å¸ƒç»„ä»¶)
   - `components/workflow/CanvasToolbar.tsx` (ç”»å¸ƒå·¥å…·æ )
   - `components/workflow/AlignmentToolbar.tsx` (å¯¹é½å·¥å…·æ )
   - `components/workflow/AlignmentLines.tsx` (å¯¹é½è¾…åŠ©çº¿)

2. **æ ·å¼æ–‡ä»¶:**
   - `styles/WorkflowCanvas.module.css`
   - `styles/CanvasToolbar.module.css`
   - `styles/AlignmentToolbar.module.css`
   - `styles/AlignmentLines.module.css`

3. **å·¥å…·æ–‡ä»¶:**
   - `lib/workflow/alignmentHelper.ts` (å¯¹é½è¾…åŠ©é€»è¾‘)

### ä¿®æ”¹æ–‡ä»¶

1. **hooks/useWorkflowTheme.ts**
   - æ·»åŠ  `tokens` å¯¼å‡º
   - å¢å¼ºä¸»é¢˜ç®¡ç†åŠŸèƒ½

## æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•

1. **ç”»å¸ƒåŸºç¡€åŠŸèƒ½:**
   - [ ] èŠ‚ç‚¹æ‹–æ”¾åˆ›å»º
   - [ ] èŠ‚ç‚¹è¿æ¥
   - [ ] èŠ‚ç‚¹é€‰æ‹©å’Œç§»åŠ¨
   - [ ] å¤šé€‰èŠ‚ç‚¹

2. **ç¼©æ”¾å’Œå¹³ç§»:**
   - [ ] é¼ æ ‡æ»šè½®ç¼©æ”¾
   - [ ] ç©ºæ ¼é”® + æ‹–æ‹½å¹³ç§»
   - [ ] ç¼©æ”¾èŒƒå›´é™åˆ¶ï¼ˆ0.5x - 2xï¼‰
   - [ ] åŠ¨ç”»æµç•…æ€§

3. **å·¥å…·æ åŠŸèƒ½:**
   - [ ] ç¼©æ”¾æŒ‰é’®
   - [ ] ç¼©æ”¾æ¯”ä¾‹æ˜¾ç¤º
   - [ ] é€‚åº”è§†å›¾
   - [ ] é‡ç½®è§†å›¾

4. **å¯¹é½åŠŸèƒ½:**
   - [ ] æ‹–æ‹½æ—¶æ˜¾ç¤ºè¾…åŠ©çº¿
   - [ ] è‡ªåŠ¨å¸é™„å¯¹é½
   - [ ] æ‰‹åŠ¨å¯¹é½å·¥å…·
   - [ ] èŠ‚ç‚¹åˆ†å¸ƒåŠŸèƒ½

5. **ä¸»é¢˜åˆ‡æ¢:**
   - [ ] æ˜æš—ä¸»é¢˜åˆ‡æ¢
   - [ ] èƒŒæ™¯é¢œè‰²é€‚é…
   - [ ] ç½‘æ ¼é¢œè‰²é€‚é…
   - [ ] è¿‡æ¸¡åŠ¨ç”»

### å“åº”å¼æµ‹è¯•

1. **æ¡Œé¢ç«¯ (>1024px):**
   - [ ] å®Œæ•´å·¥å…·æ æ˜¾ç¤º
   - [ ] å°åœ°å›¾æ˜¾ç¤º
   - [ ] æ‰€æœ‰åŠŸèƒ½æ­£å¸¸

2. **å¹³æ¿ç«¯ (768px-1024px):**
   - [ ] å·¥å…·æ é€‚é…
   - [ ] å°åœ°å›¾ç¼©å°
   - [ ] è§¦æ‘¸æ‰‹åŠ¿æ”¯æŒ

3. **ç§»åŠ¨ç«¯ (<768px):**
   - [ ] å·¥å…·æ ç®€åŒ–
   - [ ] å°åœ°å›¾éšè—
   - [ ] è§¦æ‘¸ä¼˜åŒ–

### æ€§èƒ½æµ‹è¯•

1. **å¤§è§„æ¨¡èŠ‚ç‚¹:**
   - [ ] 50+ èŠ‚ç‚¹æµç•…æ¸²æŸ“
   - [ ] ç¼©æ”¾æ€§èƒ½
   - [ ] å¹³ç§»æ€§èƒ½

2. **åŠ¨ç”»æ€§èƒ½:**
   - [ ] 60fps åŠ¨ç”»
   - [ ] æ— å¡é¡¿
   - [ ] å†…å­˜ç¨³å®š

## å·²çŸ¥é™åˆ¶

1. **å¯¹é½è¾…åŠ©çº¿:**
   - å½“å‰ä»…åœ¨æ‹–æ‹½æ—¶æ˜¾ç¤º
   - æœªæ¥å¯æ·»åŠ æŒä¹…æ˜¾ç¤ºé€‰é¡¹

2. **å·¥å…·æ ä½ç½®:**
   - å›ºå®šä½ç½®
   - æœªæ¥å¯æ·»åŠ æ‹–æ‹½è°ƒæ•´åŠŸèƒ½

3. **å°åœ°å›¾:**
   - ç§»åŠ¨ç«¯è‡ªåŠ¨éšè—
   - æœªæ¥å¯æ·»åŠ åˆ‡æ¢æŒ‰é’®

## ä¸‹ä¸€æ­¥è®¡åˆ’

æ ¹æ®ä»»åŠ¡åˆ—è¡¨ï¼Œæ¥ä¸‹æ¥åº”è¯¥å®ç°ï¼š

### Task 5: é‡æ–°è®¾è®¡è‡ªå®šä¹‰èŠ‚ç‚¹
- 5.1 åˆ›å»ºè‡ªå®šä¹‰èŠ‚ç‚¹ç»„ä»¶
- 5.2 å®ç°èŠ‚ç‚¹çŠ¶æ€æŒ‡ç¤º
- 5.3 å®ç°èŠ‚ç‚¹å‚æ•°é¢„è§ˆ
- 5.4 å®ç°èŠ‚ç‚¹é€‰ä¸­æ•ˆæœ

### Task 6: é‡æ–°è®¾è®¡æ§åˆ¶é¢æ¿
- 6.1 åˆ›å»ºæ§åˆ¶é¢æ¿å®¹å™¨
- 6.2 å®ç°æ§åˆ¶é¢æ¿å¤´éƒ¨
- 6.3 å®ç°æ“ä½œæŒ‰é’®ç»„
- 6.4 å®ç°è¾“å‡ºæ ‡ç­¾é¡µ
- 6.5 å®ç°æ—¥å¿—åˆ—è¡¨ç»„ä»¶
- 6.6 å®ç°ç»“æœåˆ—è¡¨ç»„ä»¶
- 6.7 å®ç°æ—¥å¿—å¯¼å‡ºåŠŸèƒ½

## æ€»ç»“

Task 4 "é‡æ–°è®¾è®¡å·¥ä½œæµç”»å¸ƒ" å·²å…¨é¢å®Œæˆï¼Œå®ç°äº†ï¼š

âœ… **5ä¸ªå­ä»»åŠ¡å…¨éƒ¨å®Œæˆ**
âœ… **8ä¸ªéœ€æ±‚å…¨éƒ¨æ»¡è¶³**
âœ… **9ä¸ªæ–°æ–‡ä»¶åˆ›å»º**
âœ… **1ä¸ªæ–‡ä»¶å¢å¼º**
âœ… **å®Œæ•´çš„ä¸»é¢˜æ”¯æŒ**
âœ… **æµç•…çš„äº¤äº’ä½“éªŒ**
âœ… **å¼ºå¤§çš„å¯¹é½åŠŸèƒ½**
âœ… **å“åº”å¼è®¾è®¡**
âœ… **æ€§èƒ½ä¼˜åŒ–**

ç”»å¸ƒç»„ä»¶ç°åœ¨æä¾›äº†ä¸“ä¸šã€ç°ä»£çš„å·¥ä½œæµç¼–è¾‘ä½“éªŒï¼Œä¸ºåç»­çš„èŠ‚ç‚¹å’Œæ§åˆ¶é¢æ¿é‡æ–°è®¾è®¡å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚

---

**å®Œæˆæ—¶é—´:** 2025-01-XX
**å®ç°è€…:** Kiro AI Assistant
**çŠ¶æ€:** âœ… å·²å®Œæˆ

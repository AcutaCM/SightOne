# Workflow组件可访问性 - 可视化指南

## 键盘导航流程

### 节点导航顺序

```
┌─────────────────────────────────────────────────┐
│ [1] NodeHeader                                  │
│     ┌─────────────────────────────────────────┐ │
│     │ [图标] 起飞  [!]  [3]  [⚙️]  [∨]      │ │
│     │                      ↑    ↑    ↑        │ │
│     │                      │    │    │        │ │
│     │                      │    │    └─[4] 折叠按钮
│     │                      │    └──────[3] 高级设置
│     │                      └───────────[2] 参数徽章
│     └─────────────────────────────────────────┘ │
├─────────────────────────────────────────────────┤
│ [5] ParameterList                               │
│     ┌─────────────────────────────────────────┐ │
│     │ [6] 高度: [100]                         │ │
│     │     ↓                                   │ │
│     │ [7] 速度: [50]                          │ │
│     │     ↓                                   │ │
│     │ [8] 方向: [前进]                        │ │
│     └─────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘

Tab键导航顺序: 1 → 2 → 3 → 4 → 5 → 6 → 7 → 8
```

### 焦点指示器

#### 按钮焦点
```
┌──────────────────────────────────┐
│  正常状态                         │
│  ┌────────┐                      │
│  │   ⚙️   │  ← 无边框            │
│  └────────┘                      │
└──────────────────────────────────┘

┌──────────────────────────────────┐
│  焦点状态                         │
│  ┏━━━━━━━━┓                      │
│  ┃   ⚙️   ┃  ← 2px灰色边框       │
│  ┗━━━━━━━━┛     + 背景高亮       │
└──────────────────────────────────┘
```

#### 参数项焦点
```
┌──────────────────────────────────┐
│  正常状态                         │
│  ┌────────────────────────────┐  │
│  │ 高度: 100                  │  │
│  └────────────────────────────┘  │
└──────────────────────────────────┘

┌──────────────────────────────────┐
│  焦点状态                         │
│  ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓  │
│  ┃ 高度: 100                  ┃  │
│  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  │
│     ↑                            │
│     3px灰色光晕                  │
└──────────────────────────────────┘
```

#### 节点焦点
```
┌──────────────────────────────────┐
│  正常状态                         │
│  ┌────────────────────────────┐  │
│  │ [图标] 起飞               │  │
│  ├────────────────────────────┤  │
│  │ 参数列表...                │  │
│  └────────────────────────────┘  │
└──────────────────────────────────┘

┌──────────────────────────────────┐
│  焦点状态                         │
│  ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓  │
│  ┃ [图标] 起飞               ┃  │
│  ┣━━━━━━━━━━━━━━━━━━━━━━━━━━━━┫  │
│  ┃ 参数列表...                ┃  │
│  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  │
│     ↑                            │
│     黑色边框 + 光晕              │
└──────────────────────────────────┘
```

## ARIA标签结构

### NodeHeader结构
```
<div role="banner" aria-label="起飞节点头部">
  │
  ├─ <span role="heading" aria-level={2}>
  │    起飞
  │  </span>
  │
  ├─ <div role="alert" aria-live="polite">  ← 错误时显示
  │    [!] 有未配置的必填参数
  │  </div>
  │
  ├─ <div role="status" aria-label="3个参数">  ← 折叠时显示
  │    3
  │  </div>
  │
  ├─ <button aria-label="打开高级设置" tabIndex={0}>
  │    [⚙️]
  │  </button>
  │
  └─ <button aria-label="折叠参数列表" 
             aria-expanded={true} 
             tabIndex={0}>
       [∨]
     </button>
</div>
```

### InlineParameterNode结构
```
<div role="article" 
     aria-label="起飞 工作流节点"
     aria-describedby="node-123-description"
     tabIndex={0}>
  │
  ├─ <NodeHeader />
  │
  ├─ <ParameterList />
  │
  └─ <span id="node-123-description" style="display:none">
       起飞节点，类型：基础操作，已展开，
       包含3个参数，状态：空闲
     </span>
</div>
```

### ParameterList结构
```
<div role="list" aria-label="节点参数列表" aria-live="polite">
  │
  ├─ <div role="group" aria-label="基础参数组">
  │    │
  │    ├─ <div role="heading" aria-level={3}>
  │    │    基础参数
  │    │  </div>
  │    │
  │    └─ <div role="list">
  │         │
  │         ├─ <div role="listitem">
  │         │    <ParameterItem />
  │         │  </div>
  │         │
  │         └─ <div role="listitem">
  │              <ParameterItem />
  │            </div>
  │       </div>
  │  </div>
  │
  └─ <div role="group" aria-label="高级参数组">
       ...
     </div>
</div>
```

### ParameterItem结构
```
<div role="group"
     aria-label="高度参数（必填）"
     aria-invalid={false}
     aria-describedby="param-desc-altitude"
     tabIndex={0}>
  │
  ├─ <div className="parameterLabel">
  │    高度 <span aria-label="必填项">*</span>
  │  </div>
  │
  ├─ <div className="parameterValue">
  │    100
  │  </div>
  │
  ├─ <div id="param-error-altitude"  ← 错误时显示
  │      role="alert" 
  │      aria-live="polite">
  │    [!] 高度必须在20到500之间
  │  </div>
  │
  └─ <span id="param-desc-altitude" style="display:none">
       飞行高度（厘米）
     </span>
</div>
```

## 颜色对比度可视化

### 浅色主题

```
┌─────────────────────────────────────────────────┐
│ 背景: #FFFFFF (白色)                            │
├─────────────────────────────────────────────────┤
│                                                 │
│  主要文本 (#1A1A1A)  ████████  16.1:1 AAA ✓    │
│  次要文本 (#666666)  ████████   5.74:1 AA ✓    │
│  第三级文本 (#757575) ████████   4.54:1 AA ✓    │
│  错误文本 (#DC2626)  ████████   5.9:1 AA ✓     │
│                                                 │
└─────────────────────────────────────────────────┘
```

### 深色主题

```
┌─────────────────────────────────────────────────┐
│ 背景: #1A1A1A (深灰)                            │
├─────────────────────────────────────────────────┤
│                                                 │
│  主要文本 (#E5E5E5)  ████████  13.5:1 AAA ✓    │
│  次要文本 (#999999)  ████████   5.2:1 AA ✓     │
│  第三级文本 (#8A8A8A) ████████   4.52:1 AA ✓    │
│  错误文本 (#EF4444)  ████████   5.5:1 AA ✓     │
│                                                 │
└─────────────────────────────────────────────────┘
```

### 对比度等级说明

```
┌──────────────────────────────────────────────┐
│ WCAG 2.1 对比度标准                          │
├──────────────────────────────────────────────┤
│                                              │
│  AAA级 (最佳)                                │
│  ├─ 正常文本: ≥ 7:1                         │
│  └─ 大文本: ≥ 4.5:1                         │
│                                              │
│  AA级 (推荐) ✓                               │
│  ├─ 正常文本: ≥ 4.5:1                       │
│  └─ 大文本: ≥ 3:1                           │
│                                              │
│  UI组件                                      │
│  └─ 边框/图标: ≥ 3:1                        │
│                                              │
└──────────────────────────────────────────────┘
```

## 状态指示器

### 错误状态
```
┌─────────────────────────────────────────────────┐
│ 参数项 - 错误状态                               │
├─────────────────────────────────────────────────┤
│  ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓  │
│  ┃ 高度 *                                   ┃  │
│  ┃ [100]                                    ┃  │
│  ┃ ┌──────────────────────────────────────┐ ┃  │
│  ┃ │ [!] 高度必须在20到500之间            │ ┃  │
│  ┃ └──────────────────────────────────────┘ ┃  │
│  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  │
│     ↑                    ↑                     │
│     红色边框             错误消息(role="alert") │
└─────────────────────────────────────────────────┘
```

### 编辑状态
```
┌─────────────────────────────────────────────────┐
│ 参数项 - 编辑状态                               │
├─────────────────────────────────────────────────┤
│  ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓  │
│  ┃ 高度 *                          [💾]     ┃  │
│  ┃ [150_]  ← 光标闪烁                       ┃  │
│  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  │
│     ↑                    ↑                     │
│     灰色边框+光晕        保存指示器             │
└─────────────────────────────────────────────────┘
```

### 保存成功
```
┌─────────────────────────────────────────────────┐
│ 参数项 - 保存成功                               │
├─────────────────────────────────────────────────┤
│  ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓  │
│  ┃ 高度 *                          [✓]      ┃  │
│  ┃ 150                                      ┃  │
│  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛  │
│     ↑                    ↑                     │
│     绿色脉冲动画         成功图标               │
└─────────────────────────────────────────────────┘
```

## 屏幕阅读器体验

### 节点导航示例

```
用户操作: Tab键导航到节点

屏幕阅读器读取:
┌─────────────────────────────────────────────────┐
│ "起飞 工作流节点，文章"                         │
│ "起飞节点，类型：基础操作，已展开，"            │
│ "包含3个参数，状态：空闲"                       │
└─────────────────────────────────────────────────┘

用户操作: Tab键移动到高级设置按钮

屏幕阅读器读取:
┌─────────────────────────────────────────────────┐
│ "打开高级设置，按钮"                            │
└─────────────────────────────────────────────────┘

用户操作: Tab键移动到折叠按钮

屏幕阅读器读取:
┌─────────────────────────────────────────────────┐
│ "折叠参数列表，按钮，已展开"                    │
└─────────────────────────────────────────────────┘

用户操作: Tab键移动到第一个参数

屏幕阅读器读取:
┌─────────────────────────────────────────────────┐
│ "高度参数（必填），组"                          │
│ "高度"                                          │
│ "100"                                           │
│ "飞行高度（厘米）"                              │
└─────────────────────────────────────────────────┘
```

### 错误公告示例

```
用户操作: 输入无效值并失焦

屏幕阅读器读取:
┌─────────────────────────────────────────────────┐
│ "警告"                                          │
│ "高度必须在20到500之间"                         │
└─────────────────────────────────────────────────┘
```

### 状态变化公告

```
用户操作: 保存参数

屏幕阅读器读取:
┌─────────────────────────────────────────────────┐
│ "状态"                                          │
│ "参数已保存"                                    │
└─────────────────────────────────────────────────┘
```

## 键盘操作流程图

### 编辑参数流程

```
开始
  │
  ├─ Tab键 → 聚焦到参数项
  │           │
  │           ├─ 屏幕阅读器: "高度参数（必填）"
  │           │
  │           ├─ Enter键 → 进入编辑模式
  │           │             │
  │           │             ├─ 显示输入框
  │           │             ├─ 自动聚焦
  │           │             │
  │           │             ├─ 输入新值
  │           │             │
  │           │             ├─ Tab键 → 保存并移动
  │           │             │   │
  │           │             │   ├─ 显示保存动画
  │           │             │   ├─ 屏幕阅读器: "参数已保存"
  │           │             │   └─ 移动到下一个参数
  │           │             │
  │           │             └─ Escape键 → 取消编辑
  │           │                   │
  │           │                   ├─ 恢复原值
  │           │                   └─ 退出编辑模式
  │           │
  │           └─ 如果有错误
  │                 │
  │                 ├─ 屏幕阅读器: "警告，错误消息"
  │                 └─ 显示红色边框
  │
  └─ 完成
```

## 测试场景

### 场景1: 键盘导航
```
1. 打开工作流编辑器
2. 按Tab键，焦点移动到第一个节点
3. 继续按Tab键，依次聚焦：
   - 高级设置按钮 ✓
   - 折叠按钮 ✓
   - 第一个参数 ✓
   - 第二个参数 ✓
4. 按Shift+Tab反向导航 ✓
5. 所有焦点指示器清晰可见 ✓
```

### 场景2: 参数编辑
```
1. Tab键聚焦到参数项
2. 按Enter键进入编辑模式 ✓
3. 输入新值
4. 按Tab键保存 ✓
5. 看到保存成功动画 ✓
6. 焦点移动到下一个参数 ✓
```

### 场景3: 错误处理
```
1. 输入无效值
2. 按Tab键失焦
3. 看到红色边框 ✓
4. 看到错误消息 ✓
5. 屏幕阅读器读取错误 ✓
6. 按Enter键重新编辑 ✓
```

### 场景4: 屏幕阅读器
```
1. 启动NVDA/VoiceOver
2. Tab键导航到节点
3. 听到完整的节点描述 ✓
4. Tab键移动到按钮
5. 听到按钮标签 ✓
6. Tab键移动到参数
7. 听到参数名称、值和描述 ✓
```

## 总结

本可视化指南展示了：

1. **键盘导航流程** - 清晰的Tab键导航顺序
2. **焦点指示器** - 所有可聚焦元素的视觉反馈
3. **ARIA结构** - 完整的语义化标记层次
4. **颜色对比度** - 符合WCAG标准的颜色方案
5. **状态指示** - 错误、编辑、保存等状态的视觉表现
6. **屏幕阅读器** - 辅助技术用户的体验
7. **测试场景** - 实际使用中的验证步骤

所有这些功能共同确保了Workflow组件系统对所有用户都是可访问的。

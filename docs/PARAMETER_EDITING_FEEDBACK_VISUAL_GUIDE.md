# 参数编辑反馈 - 视觉指南

## 快速参考

### 三大反馈机制

```
┌─────────────────────────────────────────────────────────┐
│  1. 编辑光晕效果 (Editing Glow)                         │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│  点击参数 → 灰色光晕脉动 (2s 循环)                     │
│  视觉: 3px-5px 光晕，黑/白半透明                        │
│                                                         │
│  2. 保存状态指示器 (Save Status)                        │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│  修改值 → [⟳] 保存中 → [✓] 成功 → 消失                │
│  时长: 100ms + 600ms = 700ms                            │
│                                                         │
│  3. 验证错误动画 (Error Animation)                      │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│  错误出现 → 抖动 (500ms) + 红色边框 + 错误提示         │
│  错误提示 2 秒后自动消失                                │
└─────────────────────────────────────────────────────────┘
```

## 状态可视化

### 1. 正常状态
```
┌─────────────────────────────────────┐
│ 参数名称                            │
│ ┌─────────────────────────────────┐ │
│ │ 当前值                          │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
  灰色边框 (#E0E0E0)
  白色背景 (#F8F8F8)
```

### 2. 悬停状态
```
┌─────────────────────────────────────┐
│ 参数名称                            │
│ ┌─────────────────────────────────┐ │
│ │ 当前值                          │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
  ↑ 轻微上移 (-1px)
  深灰边框 (#D0D0D0)
  浅灰背景 (#F0F0F0)
```

### 3. 编辑状态 (带光晕)
```
     ╔═══════════════════════════════════╗
  ╔══╣ 参数名称                          ╠══╗
  ║  ║ ┌───────────────────────────────┐ ║  ║
  ║  ║ │ [输入框]                      │ ║  ║
  ║  ║ └───────────────────────────────┘ ║  ║
  ╚══╣                                   ╠══╝
     ╚═══════════════════════════════════╝
     
  外层: 脉动光晕 (3px-5px)
  中灰边框 (#999999)
  编辑背景 (#E8E8E8)
```

### 4. 保存中状态
```
┌─────────────────────────────────────┐
│ 参数名称                      [⟳]  │  ← 旋转图标
│ ┌─────────────────────────────────┐ │
│ │ 新值                            │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
  opacity: 0.9
```

### 5. 保存成功状态
```
┌═════════════════════════════════════┐
║ 参数名称                      [✓]  ║  ← 对勾图标
║ ┌─────────────────────────────────┐ ║
║ │ 新值                            │ ║
║ └─────────────────────────────────┘ ║
╚═════════════════════════════════════╝
  脉冲效果: scale(1 → 1.02 → 1)
  光晕: 0 → 4px → 0
  持续: 600ms
```

### 6. 错误状态
```
┌─────────────────────────────────────┐
│ 参数名称                            │
│ ┌─────────────────────────────────┐ │
│ │ 无效值                          │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ [!] 此字段为必填项              │ │  ← 错误提示
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
  ↔ 抖动动画 (±8px, 5次)
  红色边框 (#DC2626)
  浅红背景 (#FEE)
```

## 动画序列图

### 编辑 → 保存流程
```
时间轴: 0ms ────────────────────────────────────────→ 800ms

用户操作:
  [点击]     [修改]     [失焦]
    ↓          ↓          ↓
    0ms       200ms      400ms

视觉反馈:
  ┌─────┐
  │编辑 │━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━→
  │光晕 │  (持续脉动，2s 循环)
  └─────┘
                         ┌────┐
                         │保存│━━━━━━━━━━━━━━━━━━━━→
                         │中  │  (100ms)
                         └────┘
                                ┌──────┐
                                │保存  │━━━━━━━━━━→
                                │成功  │  (600ms)
                                └──────┘
```

### 错误出现流程
```
时间轴: 0ms ────────────────────────────────────────→ 2500ms

错误触发:
  [验证失败]
      ↓
     0ms

视觉反馈:
  ┌─────┐
  │抖动 │━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━→
  │动画 │  (500ms)
  └─────┘
  ┌─────┐
  │错误 │━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━→
  │样式 │  (持续到修正)
  └─────┘
  ┌─────┐
  │错误 │━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━→
  │提示 │  (2000ms 后淡出)
  └─────┘
    ↑滑入                                    ↑滑出
   (300ms)                                 (300ms)
```

## 颜色参考

### 浅色主题
```css
/* 正常状态 */
--param-bg: #F8F8F8;              /* 背景 */
--param-border: #E0E0E0;          /* 边框 */
--text-secondary: #666666;        /* 标签 */
--text-primary: #1A1A1A;          /* 值 */

/* 悬停状态 */
--param-bg-hover: #F0F0F0;        /* 背景 */
--param-border-hover: #D0D0D0;    /* 边框 */

/* 编辑状态 */
--param-bg-editing: #E8E8E8;      /* 背景 */
--param-border-editing: #999999;  /* 边框 */
--param-editing-glow: rgba(0, 0, 0, 0.08);  /* 光晕 */

/* 成功状态 */
--success-color: #333333;         /* 图标 */

/* 错误状态 */
--error-color: #DC2626;           /* 边框/图标 */
--param-bg-error: #FEE;           /* 背景 */
```

### 深色主题
```css
/* 正常状态 */
--param-bg: #242424;              /* 背景 */
--param-border: #3A3A3A;          /* 边框 */
--text-secondary: #999999;        /* 标签 */
--text-primary: #E5E5E5;          /* 值 */

/* 悬停状态 */
--param-bg-hover: #2E2E2E;        /* 背景 */
--param-border-hover: #4A4A4A;    /* 边框 */

/* 编辑状态 */
--param-bg-editing: #383838;      /* 背景 */
--param-border-editing: #666666;  /* 边框 */
--param-editing-glow: rgba(255, 255, 255, 0.08);  /* 光晕 */

/* 成功状态 */
--success-color: #CCCCCC;         /* 图标 */

/* 错误状态 */
--error-color: #EF4444;           /* 边框/图标 */
--param-bg-error: rgba(220, 38, 38, 0.1);  /* 背景 */
```

## 交互流程图

```
┌──────────────┐
│  正常显示    │
│  (Normal)    │
└──────┬───────┘
       │
       │ 点击
       ↓
┌──────────────┐
│  编辑模式    │◄─────────────┐
│  (Editing)   │              │
│  + 光晕效果  │              │
└──────┬───────┘              │
       │                      │
       │ 修改值               │ Escape
       ↓                      │
┌──────────────┐              │
│  编辑中      │──────────────┘
│  (Modified)  │
└──────┬───────┘
       │
       │ 失焦/Enter
       ↓
┌──────────────┐
│  保存中      │
│  (Saving)    │
│  [⟳] 图标    │
└──────┬───────┘
       │
       │ 100ms
       ↓
┌──────────────┐
│  保存成功    │
│  (Success)   │
│  [✓] 图标    │
│  + 脉冲动画  │
└──────┬───────┘
       │
       │ 600ms
       ↓
┌──────────────┐
│  正常显示    │
│  (Normal)    │
└──────────────┘

       ┌──────────────┐
       │  验证失败    │
       │  (Error)     │
       └──────┬───────┘
              │
              ↓
       ┌──────────────┐
       │  错误状态    │
       │  + 抖动      │
       │  + 红色边框  │
       │  + 错误提示  │
       └──────┬───────┘
              │
              │ 修正值
              ↓
       ┌──────────────┐
       │  正常显示    │
       └──────────────┘
```

## 代码片段

### 使用编辑光晕
```tsx
// 自动应用，无需额外配置
<ParameterItem
  parameter={param}
  value={value}
  onChange={setValue}
/>
```

### 显示保存状态
```tsx
// 自动处理，在值改变时触发
const handleChange = (newValue) => {
  // 组件内部会:
  // 1. 显示保存中图标
  // 2. 调用 onChange
  // 3. 显示成功图标
  // 4. 触发脉冲动画
  setValue(newValue);
};
```

### 显示错误动画
```tsx
// 传入 error prop 即可触发
<ParameterItem
  parameter={param}
  value={value}
  onChange={setValue}
  error={validationError}  // ← 触发错误动画
/>
```

## 性能提示

1. **避免频繁更新**: 使用防抖处理高频输入
2. **优化动画**: 使用 CSS transform 而非 position
3. **清理定时器**: 组件卸载时清理所有 setTimeout
4. **条件渲染**: 使用 AnimatePresence 优化动画组件

## 可访问性

- **键盘导航**: Tab/Shift+Tab 在参数间移动
- **键盘操作**: Enter 保存，Escape 取消
- **屏幕阅读器**: 状态变化会被正确朗读
- **颜色对比**: 所有文本符合 WCAG AA 标准
- **焦点指示**: 清晰的焦点环和编辑光晕

## 常见问题

**Q: 为什么光晕是灰色而不是蓝色？**
A: 遵循黑白灰极简主题设计，只有错误状态使用彩色（红色）。

**Q: 保存动画太快看不清？**
A: 保存成功状态持续 600ms，足够用户感知。如需调整，修改 CSS 动画时长。

**Q: 错误提示为什么会自动消失？**
A: 避免界面混乱，2 秒后自动隐藏提示，但错误样式保持直到修正。

**Q: 如何禁用某个反馈效果？**
A: 修改对应的 CSS 类或状态管理逻辑。不建议禁用，会影响用户体验。

## 测试建议

1. **手动测试**: 点击参数，修改值，观察反馈
2. **错误测试**: 输入无效值，检查错误动画
3. **键盘测试**: 使用 Tab、Enter、Escape 测试
4. **主题测试**: 切换浅色/深色主题，检查颜色
5. **性能测试**: 快速连续编辑多个参数

## 相关文档

- [参数编辑反馈完整文档](./PARAMETER_EDITING_FEEDBACK_COMPLETE.md)
- [ParameterItem 实现文档](./PARAMETER_ITEM_IMPLEMENTATION.md)
- [Workflow 主题重设计](./WORKFLOW_THEME_REDESIGN_PREVIEW.md)

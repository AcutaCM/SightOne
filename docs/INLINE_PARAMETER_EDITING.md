# 内联参数编辑功能用户指南

## 📖 目录

- [功能概述](#功能概述)
- [快速开始](#快速开始)
- [核心功能](#核心功能)
  - [查看节点参数](#查看节点参数)
  - [内联编辑参数](#内联编辑参数)
  - [折叠和展开节点](#折叠和展开节点)
  - [高级设置](#高级设置)
  - [调整节点大小](#调整节点大小)
- [参数类型](#参数类型)
- [参数验证](#参数验证)
- [节点状态](#节点状态)
- [使用技巧](#使用技巧)
- [常见问题](#常见问题)
- [键盘快捷键](#键盘快捷键)

---

## 功能概述

内联参数编辑功能允许您直接在工作流画布上的节点卡片中查看和编辑参数，无需打开额外的对话框。这大大提升了工作流编辑的效率和流畅度。

### 主要优势

✅ **直观可视** - 所有参数直接显示在节点上，一目了然  
✅ **快速编辑** - 点击参数值即可编辑，无需打开模态框  
✅ **实时验证** - 参数输入时立即验证，错误提示清晰  
✅ **智能布局** - 节点大小根据参数数量自动调整  
✅ **灵活控制** - 支持折叠/展开，节省画布空间  
✅ **保留高级功能** - 复杂配置仍可使用高级设置面板

### 适用场景

- 🎯 快速调整无人机飞行参数（高度、速度、距离等）
- 🔧 配置检测节点的阈值和选项
- 🤖 设置AI分析节点的参数
- 📊 调整数据处理节点的配置
- 🎮 编辑挑战任务的得分规则

---

## 快速开始

### 第一步：创建节点

1. 从左侧节点库拖拽一个节点到画布
2. 节点会自动显示所有可配置的参数
3. 默认参数值会以灰色文本显示

![创建节点示例](./images/inline-editing-create-node.png)

### 第二步：编辑参数

1. **点击参数值**进入编辑模式
2. 输入新的值
3. **点击其他区域**或按**Enter键**保存
4. 参数会自动验证并更新

![编辑参数示例](./images/inline-editing-edit-param.png)

### 第三步：运行工作流

1. 配置完所有节点参数
2. 连接节点形成工作流
3. 点击"运行"按钮执行
4. 观察节点状态变化

![运行工作流示例](./images/inline-editing-run-workflow.png)

---

## 核心功能

### 查看节点参数

#### 参数显示格式

每个参数项包含以下信息：

```
参数名称 *          ← 必填参数带星号
当前值 单位         ← 值和单位（如适用）
```

#### 参数状态指示

- **灰色文本** - 默认值，未修改
- **白色文本** - 自定义值，已修改
- **红色边框** - 验证错误
- **绿色闪烁** - 刚保存成功

#### 参数分组

参数可能按功能分组显示：

- **基础参数** - 常用的核心配置
- **高级参数** - 专业用户使用的选项
- **检测参数** - 检测相关的配置
- **AI参数** - AI模型相关的设置

### 内联编辑参数

#### 数字参数

**适用于：** 高度、速度、距离、角度、阈值等

**编辑方式：**
1. 点击数字值
2. 输入新数字
3. 自动验证范围（最小值/最大值）
4. 显示单位（cm、秒、度等）

**示例：**
```
起飞高度: [100] cm
有效范围: 20-500 cm
```

**特性：**
- ✅ 支持小数点（如 1.5）
- ✅ 支持负数（如 -10）
- ✅ 自动限制在有效范围内
- ✅ 显示单位提示

#### 文本参数

**适用于：** 名称、描述、路径、命令等

**编辑方式：**
1. 点击文本值
2. 输入或修改文本
3. 支持单行或多行输入
4. 自动保存

**示例：**
```
节点名称: [我的检测任务]
描述: [检测草莓成熟度]
```

**特性：**
- ✅ 支持中英文输入
- ✅ 多行文本自动扩展
- ✅ 字符计数提示
- ✅ 占位符提示

#### 选择参数

**适用于：** 模式选择、选项配置等

**编辑方式：**
1. 点击当前选项
2. 从下拉列表选择
3. 支持搜索过滤
4. 立即生效

**示例：**
```
检测模式: [自动] ▼
选项: 自动 / 手动 / 智能
```

**特性：**
- ✅ 下拉菜单显示所有选项
- ✅ 支持键盘导航
- ✅ 搜索过滤功能
- ✅ 当前选项高亮

#### 布尔参数

**适用于：** 开关选项、启用/禁用功能

**编辑方式：**
1. 点击开关
2. 切换开/关状态
3. 立即生效

**示例：**
```
启用检测: ⚫ 关 | ⚪ 开
自动保存: ⚪ 开
```

**特性：**
- ✅ 清晰的开/关状态
- ✅ 一键切换
- ✅ 视觉反馈明显
- ✅ 支持键盘操作

#### 滑块参数

**适用于：** 百分比、权重、比例等

**编辑方式：**
1. 拖动滑块
2. 或点击输入精确值
3. 实时预览效果
4. 显示当前值

**示例：**
```
置信度阈值: ━━━●━━━ 75%
范围: 0% - 100%
```

**特性：**
- ✅ 拖动调整
- ✅ 实时预览
- ✅ 精确输入
- ✅ 步进值控制

### 折叠和展开节点

#### 为什么要折叠节点？

- 📦 **节省空间** - 大型工作流中保持画布整洁
- 👀 **聚焦重点** - 只展开正在编辑的节点
- 🎯 **快速浏览** - 折叠状态下仍可看到节点类型和参数数量
- ⚡ **提升性能** - 减少渲染的UI元素

#### 如何折叠/展开

**方法1：点击折叠按钮**
- 位置：节点头部右上角
- 图标：▼（展开）/ ▲（折叠）
- 效果：平滑动画切换

**方法2：双击节点头部**
- 快速切换折叠状态
- 适合频繁操作

**方法3：键盘快捷键**
- 选中节点后按 `Space` 键
- 批量操作多个节点

#### 折叠状态显示

折叠后节点显示：

```
┌─────────────────────────┐
│ 🛫 起飞      [3]  ⚙️ ▼ │
└─────────────────────────┘
```

- **图标和名称** - 节点类型
- **数字徽章** - 参数数量
- **⚙️ 按钮** - 高级设置
- **▼ 按钮** - 展开参数

#### 展开状态显示

展开后节点显示：

```
┌─────────────────────────┐
│ 🛫 起飞         ⚙️ ▲    │
├─────────────────────────┤
│ 高度: 100 cm            │
│ 速度: 50 cm/s           │
│ 延迟: 2 秒              │
└─────────────────────────┘
```

#### 折叠状态持久化

- ✅ 折叠状态会自动保存
- ✅ 重新打开工作流时保持折叠状态
- ✅ 导出/导入工作流时保留折叠状态

### 高级设置

#### 何时使用高级设置？

虽然大多数参数可以内联编辑，但以下情况建议使用高级设置面板：

- 🔧 **复杂配置** - 需要同时调整多个相关参数
- 📋 **批量编辑** - 一次性修改多个参数
- 📖 **查看文档** - 需要详细的参数说明
- 🎨 **使用预设** - 应用预定义的参数组合
- 🔍 **参数搜索** - 在大量参数中快速查找

#### 打开高级设置

**方法1：点击设置按钮**
- 位置：节点头部右上角
- 图标：⚙️
- 效果：打开完整配置面板

**方法2：双击节点**
- 快速打开高级设置
- 适合习惯旧版操作的用户

**方法3：右键菜单**
- 右键点击节点
- 选择"高级设置"

#### 高级设置面板功能

高级设置面板提供：

1. **完整参数列表**
   - 所有参数分类显示
   - 搜索和过滤功能
   - 参数依赖关系提示

2. **参数预设**
   - 常用配置快速应用
   - 自定义预设保存
   - 预设导入/导出

3. **参数文档**
   - 每个参数的详细说明
   - 有效值范围和示例
   - 最佳实践建议

4. **批量操作**
   - 重置为默认值
   - 复制参数配置
   - 粘贴到其他节点

#### 高级设置与内联编辑的关系

- ✅ 两种方式**互相同步**
- ✅ 在高级设置中修改会**立即反映**到节点卡片
- ✅ 内联编辑的修改会**实时更新**到高级设置
- ✅ 可以**随时切换**使用方式

### 调整节点大小

#### 自动调整

节点会根据参数数量自动调整大小：

- **紧凑模式** (< 3个参数)
  - 宽度：240px
  - 适合简单节点

- **标准模式** (3-6个参数)
  - 宽度：280px
  - 最常用的尺寸

- **扩展模式** (> 6个参数)
  - 宽度：320px
  - 提供滚动功能

#### 手动调整

**如何调整：**

1. 找到节点右下角的调整手柄
2. 鼠标悬停显示 ↘️ 图标
3. 按住并拖动调整大小
4. 释放鼠标完成调整

**尺寸限制：**

- 最小宽度：200px
- 最大宽度：600px
- 最小高度：150px
- 最大高度：800px

**调整时的视觉反馈：**

- 🔵 节点边框高亮
- 📏 显示当前尺寸（宽×高）
- ✨ 实时预览布局变化

**自适应布局：**

- 宽度较小时：单列布局
- 宽度较大时：双列布局（如适用）
- 高度不足时：自动显示滚动条

#### 重置大小

**方法1：双击调整手柄**
- 快速重置为自动大小

**方法2：右键菜单**
- 右键点击节点
- 选择"重置大小"

**方法3：高级设置**
- 打开高级设置面板
- 点击"重置布局"按钮

---

## 参数类型

### 支持的参数类型

| 类型 | 说明 | 示例 | 编辑器 |
|------|------|------|--------|
| `number` | 数字 | 100, 1.5, -10 | 数字输入框 |
| `string` | 文本 | "起飞任务" | 文本输入框 |
| `textarea` | 多行文本 | 长描述 | 多行文本框 |
| `boolean` | 布尔值 | true, false | 开关 |
| `select` | 选择 | "自动", "手动" | 下拉菜单 |
| `slider` | 滑块 | 0-100 | 滑块控件 |
| `assistant` | AI助手 | 助手选择 | 助手选择器 |

### 参数属性

每个参数可能包含以下属性：

```typescript
{
  name: "height",           // 参数名称（内部使用）
  label: "起飞高度",        // 显示标签
  type: "number",           // 参数类型
  defaultValue: 100,        // 默认值
  required: true,           // 是否必填
  description: "...",       // 参数说明
  min: 20,                  // 最小值（数字类型）
  max: 500,                 // 最大值（数字类型）
  step: 10,                 // 步进值（数字类型）
  unit: "cm",               // 单位
  placeholder: "请输入...", // 占位符
  options: [...],           // 选项列表（选择类型）
  priority: 1,              // 优先级（1-10）
  group: "基础参数",        // 参数分组
}
```

---

## 参数验证

### 验证规则

#### 必填验证

必填参数必须有值：

```
❌ 错误：参数值为空
✅ 正确：参数有有效值
```

**视觉提示：**
- 参数名称后显示 `*` 星号
- 未填写时节点头部显示 ⚠️ 警告图标
- 参数项显示红色边框

#### 类型验证

参数值必须符合指定类型：

```
数字类型：
❌ "abc" → 必须是有效的数字
✅ 100 → 正确

布尔类型：
❌ "yes" → 必须是 true 或 false
✅ true → 正确
```

#### 范围验证

数字参数必须在有效范围内：

```
高度参数（20-500 cm）：
❌ 10 → 值不能小于 20
❌ 600 → 值不能大于 500
✅ 100 → 正确
```

#### 自定义验证

某些参数有特殊验证规则：

```
IP地址：
❌ "192.168.1" → 格式不正确
✅ "192.168.1.1" → 正确

文件路径：
❌ "C:\invalid<>path" → 包含非法字符
✅ "C:\valid\path" → 正确
```

### 错误提示

#### 内联错误提示

参数验证失败时，会在参数下方显示错误消息：

```
┌─────────────────────────┐
│ 起飞高度: [10] cm       │
│ ⚠️ 值不能小于 20        │
└─────────────────────────┘
```

#### 节点头部警告

有未配置的必填参数时，节点头部显示警告图标：

```
┌─────────────────────────┐
│ 🛫 起飞 ⚠️      ⚙️ ▲   │
└─────────────────────────┘
```

#### 工作流验证

运行工作流前，系统会验证所有节点：

- ✅ 所有必填参数已配置
- ✅ 所有参数值有效
- ✅ 节点连接正确
- ❌ 发现错误时阻止运行并提示

### 实时验证

参数编辑时会实时验证：

1. **输入时验证** - 每次按键都会检查
2. **失焦时验证** - 离开输入框时完整验证
3. **保存前验证** - 保存前最后检查
4. **运行前验证** - 执行工作流前全面验证

---

## 节点状态

### 状态类型

节点在不同阶段会显示不同的状态：

#### 空闲状态 (Idle)

- **颜色：** 灰色 ⚫
- **说明：** 节点未执行，等待运行
- **操作：** 可以编辑参数

#### 运行中状态 (Running)

- **颜色：** 橙色 🟠（脉冲动画）
- **说明：** 节点正在执行
- **操作：** 不可编辑参数
- **额外：** 底部显示进度条动画

#### 成功状态 (Success)

- **颜色：** 绿色 🟢
- **说明：** 节点执行成功
- **操作：** 可以查看结果

#### 错误状态 (Error)

- **颜色：** 红色 🔴
- **说明：** 节点执行失败
- **操作：** 可以查看错误信息并修复

### 状态指示器

状态指示器位于节点右上角：

```
┌─────────────────────────┐
│ 🛫 起飞         ⚙️ ▲  🟢│ ← 状态指示器
├─────────────────────────┤
│ 参数列表...             │
└─────────────────────────┘
```

### 状态动画

不同状态有不同的视觉效果：

- **运行中：** 脉冲动画 + 进度条
- **成功：** 短暂的绿色闪烁
- **错误：** 红色边框 + 抖动效果

---

## 使用技巧

### 提升效率的技巧

#### 1. 使用键盘快捷键

- `Tab` - 在参数间切换
- `Enter` - 保存当前参数
- `Esc` - 取消编辑
- `Space` - 折叠/展开节点（选中时）
- `Ctrl+C` / `Ctrl+V` - 复制/粘贴参数配置

#### 2. 批量配置相似节点

1. 配置第一个节点的参数
2. 右键点击节点 → "复制参数"
3. 选择其他相似节点
4. 右键 → "粘贴参数"

#### 3. 使用参数预设

1. 配置好常用的参数组合
2. 打开高级设置 → "保存为预设"
3. 下次直接选择预设快速应用

#### 4. 折叠不常用的节点

- 配置完成的节点可以折叠
- 保持画布整洁
- 聚焦当前编辑的节点

#### 5. 利用参数优先级

- 紧凑模式下只显示高优先级参数
- 快速调整核心配置
- 需要时展开查看所有参数

### 最佳实践

#### 参数命名

- ✅ 使用清晰的参数名称
- ✅ 添加单位说明
- ✅ 提供合理的默认值
- ❌ 避免使用缩写或代码

#### 参数组织

- ✅ 按功能分组参数
- ✅ 高频参数设置高优先级
- ✅ 相关参数放在一起
- ❌ 避免参数过多（考虑拆分节点）

#### 验证设置

- ✅ 设置合理的范围限制
- ✅ 提供清晰的错误提示
- ✅ 使用占位符提示格式
- ❌ 避免过于严格的验证

#### 用户体验

- ✅ 提供参数说明和示例
- ✅ 使用合适的编辑器类型
- ✅ 保持界面简洁
- ❌ 避免过多的必填参数

---

## 常见问题

### Q1: 参数修改后没有保存？

**A:** 确保完成以下操作之一：
- 点击参数外的其他区域
- 按 `Enter` 键
- 切换到其他参数

参数会自动保存，无需手动点击保存按钮。

### Q2: 节点显示警告图标？

**A:** 这表示有必填参数未配置：
1. 查看参数列表中带 `*` 的参数
2. 填写所有必填参数
3. 警告图标会自动消失

### Q3: 如何重置参数为默认值？

**A:** 有三种方法：
1. 打开高级设置 → 点击"重置为默认值"
2. 右键点击参数 → "重置"
3. 删除参数值，会自动恢复默认值

### Q4: 参数太多，节点太大怎么办？

**A:** 可以：
1. 折叠节点，只在需要时展开
2. 使用紧凑模式，只显示优先级参数
3. 手动调整节点大小
4. 考虑拆分为多个小节点

### Q5: 如何快速找到某个参数？

**A:** 
1. 打开高级设置面板
2. 使用搜索功能
3. 或按参数分组浏览

### Q6: 参数编辑器不显示？

**A:** 检查：
1. 节点是否处于运行状态（运行时不可编辑）
2. 参数是否设置为只读
3. 是否有权限编辑该节点

### Q7: 如何复制节点的参数配置？

**A:** 
1. 右键点击源节点 → "复制参数"
2. 右键点击目标节点 → "粘贴参数"
3. 或使用 `Ctrl+C` / `Ctrl+V`

### Q8: 折叠状态不保存？

**A:** 
1. 确保工作流已保存
2. 检查浏览器是否允许本地存储
3. 尝试手动保存工作流

### Q9: 参数验证太严格？

**A:** 
1. 检查参数定义的范围限制
2. 联系管理员调整验证规则
3. 使用高级设置查看详细说明

### Q10: 如何自定义节点大小？

**A:** 
1. 拖动右下角的调整手柄
2. 或在高级设置中输入精确尺寸
3. 双击调整手柄重置为自动大小

---

## 键盘快捷键

### 全局快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+S` | 保存工作流 |
| `Ctrl+Z` | 撤销 |
| `Ctrl+Y` | 重做 |
| `Delete` | 删除选中节点 |
| `Ctrl+C` | 复制节点 |
| `Ctrl+V` | 粘贴节点 |
| `Ctrl+A` | 全选节点 |

### 节点操作快捷键

| 快捷键 | 功能 |
|--------|------|
| `Space` | 折叠/展开节点 |
| `Enter` | 打开高级设置 |
| `E` | 进入编辑模式 |
| `R` | 重置参数 |
| `D` | 复制节点 |

### 参数编辑快捷键

| 快捷键 | 功能 |
|--------|------|
| `Tab` | 下一个参数 |
| `Shift+Tab` | 上一个参数 |
| `Enter` | 保存参数 |
| `Esc` | 取消编辑 |
| `↑` / `↓` | 调整数字值 |
| `Ctrl+Enter` | 保存并关闭 |

### 画布操作快捷键

| 快捷键 | 功能 |
|--------|------|
| `鼠标滚轮` | 缩放画布 |
| `空格+拖动` | 平移画布 |
| `Ctrl+0` | 重置缩放 |
| `Ctrl+1` | 适应画布 |
| `F` | 聚焦选中节点 |

---

## 总结

内联参数编辑功能为工作流编辑带来了全新的体验：

✨ **更直观** - 参数直接显示在节点上  
⚡ **更快速** - 无需打开模态框即可编辑  
🎯 **更精确** - 实时验证和错误提示  
🎨 **更灵活** - 支持折叠、调整大小等  
🚀 **更高效** - 提升工作流编辑效率

开始使用内联参数编辑，让您的工作流编辑更加流畅！

---

## 相关文档

- [工作流系统快速开始](./WORKFLOW_QUICK_START.md)
- [节点系统完整指南](./WORKFLOW_NODE_SYSTEM_COMPLETE.md)
- [InlineParameterNode实现文档](./INLINE_PARAMETER_NODE_IMPLEMENTATION.md)
- [NodeHeader实现文档](./NODE_HEADER_IMPLEMENTATION.md)
- [参数编辑器实现文档](./PARAMETER_EDITORS_IMPLEMENTATION.md)

## 技术支持

如有问题或建议，请：
1. 查看相关文档
2. 检查常见问题
3. 联系技术支持团队

---

**文档版本：** 1.0.0  
**最后更新：** 2024年  
**适用版本：** Drone Analyzer v2.0+

# åŠ©ç†ç³»ç»Ÿ Bug ä¿®å¤å®Œæˆ âœ…

## ğŸ¯ ä¿®å¤çš„é—®é¢˜

### âœ… é—®é¢˜ 1: ä¸»é¡µé¢åˆ›å»ºçš„åŠ©ç†åœ¨ admin/review çœ‹ä¸åˆ°
**æ ¹æœ¬åŸå› **: Table çš„ `rowKey` è®¾è®¡ä¸å½“

**ä¿®å¤å†…å®¹**:
```tsx
// âŒ ä¿®å¤å‰ - å¤æ‚çš„ rowKey å¯¼è‡´ React æ— æ³•è¿½è¸ªæ›´æ–°
rowKey={(record) => `${record.id}-${record.status}-${record.updatedAt?.getTime() || record.createdAt.getTime()}`}

// âœ… ä¿®å¤å - ä½¿ç”¨ç®€å•çš„ id
rowKey="id"
```

**å½±å“**: ç°åœ¨åˆ›å»ºçš„åŠ©ç†ä¼šç«‹å³åœ¨å®¡æ ¸é¡µé¢æ˜¾ç¤º

---

### âœ… é—®é¢˜ 2: ç‚¹å‡»é€šè¿‡/æ‹’ç»æŒ‰é’®æ²¡æœ‰ååº”
**æ ¹æœ¬åŸå› **: 
1. Table rowKey å˜åŒ–å¯¼è‡´ React æ— æ³•æ›´æ–° UI
2. ç¼ºå°‘ loading çŠ¶æ€åé¦ˆ

**ä¿®å¤å†…å®¹**:
1. ç®€åŒ– rowKeyï¼ˆè§é—®é¢˜ 1ï¼‰
2. æ·»åŠ  loading çŠ¶æ€:
```tsx
const [loading, setLoading] = useState(false);

const handleApprove = (record: Assistant) => {
  Modal.confirm({
    onOk: () => {
      setLoading(true);
      return new Promise((resolve) => {
        updateAssistantStatus(record.id, 'published');
        message.success(`"${record.title}"å·²é€šè¿‡å®¡æ ¸å¹¶ä¸Šæ¶åˆ°å•†åŸï¼`, 2);
        setTimeout(() => {
          setLoading(false);
          resolve(true);
        }, 500);
      });
    },
  });
};
```

3. Table æ·»åŠ  loading å±æ€§:
```tsx
<Table
  loading={loading}
  // ...
/>
```

**å½±å“**: 
- æŒ‰é’®ç‚¹å‡»åæœ‰æ˜ç¡®çš„åŠ è½½åé¦ˆ
- çŠ¶æ€æ›´æ–°ç«‹å³åæ˜ åœ¨ UI ä¸Š

---

### âœ… é—®é¢˜ 3: é€šè¿‡çš„åŠ©ç†æ²¡æœ‰åœ¨å¸‚åœºæ˜¾ç¤º
**æ ¹æœ¬åŸå› **: çŠ¶æ€æ²¡æœ‰æ­£ç¡®æ›´æ–°ï¼ˆè§é—®é¢˜ 2ï¼‰

**ä¿®å¤å†…å®¹**:
ä¼˜åŒ– Context çš„ `updateAssistantStatus` å‡½æ•°ï¼Œç«‹å³ä¿å­˜åˆ° localStorage:
```tsx
const updateAssistantStatus = (id: string, status: Assistant['status']) => {
  setAssistantList(prev => {
    const newList = prev.map(item => {
      if (item.id === id) {
        const updates: Partial<Assistant> = {
          status,
          reviewedAt: new Date(),
        };
        if (status === 'published') {
          updates.publishedAt = new Date();
        }
        return { ...item, ...updates };
      }
      return item;
    });
    
    // ç«‹å³ä¿å­˜åˆ° localStorage ç¡®ä¿åŒæ­¥
    if (typeof window !== 'undefined') {
      localStorage.setItem('assistantList', JSON.stringify(newList));
    }
    
    return newList;
  });
};
```

**å½±å“**: 
- å®¡æ ¸é€šè¿‡çš„åŠ©ç†ç«‹å³åœ¨å¸‚åœºæ˜¾ç¤º
- è·¨æ ‡ç­¾é¡µå®æ—¶åŒæ­¥

---

### âœ… é—®é¢˜ 4: çŠ¶æ€æ›´æ–°åæ²¡æœ‰è§†è§‰åé¦ˆ
**æ ¹æœ¬åŸå› **: ç¼ºå°‘åŠ è½½çŠ¶æ€å’Œæ˜ç¡®çš„æ¶ˆæ¯æç¤º

**ä¿®å¤å†…å®¹**:
1. æ‰€æœ‰æ“ä½œéƒ½æ·»åŠ  loading çŠ¶æ€
2. ä¼˜åŒ–æ¶ˆæ¯æç¤º:
```tsx
// é€šè¿‡å®¡æ ¸
message.success(`"${record.title}"å·²é€šè¿‡å®¡æ ¸å¹¶ä¸Šæ¶åˆ°å•†åŸï¼`, 2);

// æ‹’ç»å®¡æ ¸
message.warning(`"${record.title}"å·²è¢«æ‹’ç»`, 2);

// åˆ é™¤åŠ©ç†
message.success(`"${record.title}"å·²åˆ é™¤`, 2);
```

3. å¢åŠ æ“ä½œå»¶è¿Ÿç¡®ä¿ç”¨æˆ·çœ‹åˆ°åé¦ˆ:
```tsx
setTimeout(() => {
  setLoading(false);
  resolve(true);
}, 500);
```

**å½±å“**: 
- ç”¨æˆ·æ¸…æ¥šçŸ¥é“æ“ä½œæ˜¯å¦æˆåŠŸ
- æœ‰è¶³å¤Ÿæ—¶é—´çœ‹åˆ°çŠ¶æ€å˜åŒ–

---

## ğŸ“‹ ä¿®å¤æ¸…å•

- âœ… ä¿®å¤ 1: ç®€åŒ– Table rowKey
- âœ… ä¿®å¤ 2: æ·»åŠ  Table loading çŠ¶æ€
- âœ… ä¿®å¤ 3: æ·»åŠ æ‰€æœ‰æ“ä½œçš„ loading åé¦ˆ
- âœ… ä¿®å¤ 4: ä¼˜åŒ– Context æ›´æ–°é€»è¾‘
- âœ… ä¿®å¤ 5: ä¼˜åŒ–æ¶ˆæ¯æç¤º
- âœ… ä¿®å¤ 6: æ‰¹é‡æ“ä½œæ·»åŠ  loading
- âœ… ä¿®å¤ 7: è¯¦æƒ…å¯¹è¯æ¡†æ“ä½œæ·»åŠ  loading

---

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

### 1. `contexts/AssistantContext.tsx`
**ä¿®æ”¹å†…å®¹**:
- ä¼˜åŒ– `updateAssistantStatus` å‡½æ•°
- ç«‹å³ä¿å­˜åˆ° localStorage

### 2. `app/admin/review/page.tsx`
**ä¿®æ”¹å†…å®¹**:
- ç®€åŒ– Table rowKey: `rowKey="id"`
- æ·»åŠ  loading çŠ¶æ€: `const [loading, setLoading] = useState(false)`
- Table æ·»åŠ  loading å±æ€§: `<Table loading={loading} />`
- æ‰€æœ‰æ“ä½œå‡½æ•°æ·»åŠ  loading çŠ¶æ€ç®¡ç†
- ä¼˜åŒ–æ¶ˆæ¯æç¤ºæ—¶é•¿å’Œç±»å‹
- å¢åŠ æ“ä½œå»¶è¿Ÿç¡®ä¿åé¦ˆå¯è§

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æµ‹è¯• 1: åˆ›å»ºåŠ©ç†
1. æ‰“å¼€ä¸»é¡µé¢
2. ç‚¹å‡»åˆ›å»ºåŠ©ç†æŒ‰é’®
3. å¡«å†™åŠ©ç†ä¿¡æ¯å¹¶æäº¤
4. æ‰“å¼€å®¡æ ¸é¡µé¢ï¼š`http://localhost:3000/admin/review`
5. âœ… åº”è¯¥ç«‹å³çœ‹åˆ°åˆšåˆ›å»ºçš„åŠ©ç†ï¼ˆçŠ¶æ€ä¸º"å¾…å®¡æ ¸"ï¼‰

### æµ‹è¯• 2: å®¡æ ¸é€šè¿‡
1. åœ¨å®¡æ ¸é¡µé¢æ‰¾åˆ°å¾…å®¡æ ¸çš„åŠ©ç†
2. ç‚¹å‡»"é€šè¿‡"æŒ‰é’®
3. ç¡®è®¤å®¡æ ¸é€šè¿‡
4. âœ… åº”è¯¥çœ‹åˆ° loading çŠ¶æ€
5. âœ… åº”è¯¥çœ‹åˆ°æˆåŠŸæ¶ˆæ¯
6. âœ… çŠ¶æ€åº”è¯¥å˜ä¸º"å·²å‘å¸ƒ"
7. å›åˆ°ä¸»é¡µé¢çš„å¸‚åœºæ ‡ç­¾
8. âœ… åº”è¯¥èƒ½çœ‹åˆ°åˆšå®¡æ ¸é€šè¿‡çš„åŠ©ç†

### æµ‹è¯• 3: å®¡æ ¸æ‹’ç»
1. åœ¨å®¡æ ¸é¡µé¢æ‰¾åˆ°å¾…å®¡æ ¸çš„åŠ©ç†
2. ç‚¹å‡»"æ‹’ç»"æŒ‰é’®
3. ç¡®è®¤æ‹’ç»
4. âœ… åº”è¯¥çœ‹åˆ° loading çŠ¶æ€
5. âœ… åº”è¯¥çœ‹åˆ°è­¦å‘Šæ¶ˆæ¯
6. âœ… çŠ¶æ€åº”è¯¥å˜ä¸º"å·²æ‹’ç»"

### æµ‹è¯• 4: ç¼–è¾‘åŠ©ç†
1. åœ¨å®¡æ ¸é¡µé¢ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®
2. ä¿®æ”¹åŠ©ç†ä¿¡æ¯
3. ç‚¹å‡»ä¿å­˜
4. âœ… åº”è¯¥çœ‹åˆ°æˆåŠŸæ¶ˆæ¯
5. âœ… ä¿¡æ¯åº”è¯¥å·²æ›´æ–°

### æµ‹è¯• 5: åˆ é™¤åŠ©ç†
1. åœ¨å®¡æ ¸é¡µé¢ç‚¹å‡»"åˆ é™¤"æŒ‰é’®
2. ç¡®è®¤åˆ é™¤
3. âœ… åº”è¯¥çœ‹åˆ° loading çŠ¶æ€
4. âœ… åº”è¯¥çœ‹åˆ°æˆåŠŸæ¶ˆæ¯
5. âœ… åŠ©ç†åº”è¯¥ä»åˆ—è¡¨ä¸­æ¶ˆå¤±

### æµ‹è¯• 6: æ‰¹é‡æ“ä½œ
1. é€‰ä¸­å¤šä¸ªå¾…å®¡æ ¸çš„åŠ©ç†
2. ç‚¹å‡»"æ‰¹é‡é€šè¿‡"æˆ–"æ‰¹é‡æ‹’ç»"
3. ç¡®è®¤æ“ä½œ
4. âœ… åº”è¯¥çœ‹åˆ° loading çŠ¶æ€
5. âœ… åº”è¯¥çœ‹åˆ°æˆåŠŸæ¶ˆæ¯
6. âœ… æ‰€æœ‰é€‰ä¸­çš„åŠ©ç†çŠ¶æ€åº”è¯¥å·²æ›´æ–°

### æµ‹è¯• 7: è·¨æ ‡ç­¾é¡µåŒæ­¥
1. æ‰“å¼€ä¸¤ä¸ªæµè§ˆå™¨æ ‡ç­¾é¡µ
2. åœ¨ç¬¬ä¸€ä¸ªæ ‡ç­¾é¡µå®¡æ ¸é€šè¿‡ä¸€ä¸ªåŠ©ç†
3. åˆ‡æ¢åˆ°ç¬¬äºŒä¸ªæ ‡ç­¾é¡µ
4. âœ… åº”è¯¥çœ‹åˆ°çŠ¶æ€å·²åŒæ­¥æ›´æ–°

---

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›

### 1. ç®€åŒ– rowKey
**ä¹‹å‰**: ä½¿ç”¨å¤åˆ key åŒ…å«ä¼šå˜åŒ–çš„å­—æ®µ
```tsx
rowKey={(record) => `${record.id}-${record.status}-${record.updatedAt?.getTime()}`}
```

**ç°åœ¨**: ä½¿ç”¨ç®€å•çš„å”¯ä¸€æ ‡è¯†ç¬¦
```tsx
rowKey="id"
```

**å¥½å¤„**:
- React èƒ½æ­£ç¡®è¿½è¸ªè¡Œæ›´æ–°
- çŠ¶æ€å˜åŒ–ç«‹å³åæ˜ åœ¨ UI
- é€‰ä¸­çŠ¶æ€ä¸ä¼šä¸¢å¤±

### 2. æ·»åŠ  Loading çŠ¶æ€
**å¥½å¤„**:
- ç”¨æˆ·çŸ¥é“æ“ä½œæ­£åœ¨è¿›è¡Œ
- é˜²æ­¢é‡å¤ç‚¹å‡»
- æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

### 3. ä¼˜åŒ–æ¶ˆæ¯æç¤º
**å¥½å¤„**:
- æ˜ç¡®çš„æˆåŠŸ/å¤±è´¥åé¦ˆ
- é€‚å½“çš„æ˜¾ç¤ºæ—¶é•¿ï¼ˆ2ç§’ï¼‰
- ä¸åŒæ“ä½œä½¿ç”¨ä¸åŒçš„æ¶ˆæ¯ç±»å‹

### 4. ç«‹å³ä¿å­˜åˆ° localStorage
**å¥½å¤„**:
- ç¡®ä¿æ•°æ®æŒä¹…åŒ–
- è·¨æ ‡ç­¾é¡µå®æ—¶åŒæ­¥
- é˜²æ­¢æ•°æ®ä¸¢å¤±

---

## ğŸš€ é¢„æœŸæ•ˆæœ

ä¿®å¤åçš„ç³»ç»Ÿåº”è¯¥ï¼š

1. âœ… **åˆ›å»ºæµç¨‹é¡ºç•…**
   - ä¸»é¡µé¢åˆ›å»º â†’ ç«‹å³åœ¨å®¡æ ¸é¡µé¢æ˜¾ç¤º

2. âœ… **å®¡æ ¸æµç¨‹æ¸…æ™°**
   - ç‚¹å‡»æŒ‰é’® â†’ loading çŠ¶æ€ â†’ æˆåŠŸæ¶ˆæ¯ â†’ çŠ¶æ€æ›´æ–°

3. âœ… **å¸‚åœºæ˜¾ç¤ºæ­£ç¡®**
   - å®¡æ ¸é€šè¿‡ â†’ ç«‹å³åœ¨å¸‚åœºæ˜¾ç¤º

4. âœ… **æ“ä½œåé¦ˆæ˜ç¡®**
   - æ‰€æœ‰æ“ä½œéƒ½æœ‰æ¸…æ™°çš„è§†è§‰åé¦ˆ
   - ç”¨æˆ·çŸ¥é“æ“ä½œæ˜¯å¦æˆåŠŸ

5. âœ… **æ•°æ®åŒæ­¥å®æ—¶**
   - è·¨æ ‡ç­¾é¡µå®æ—¶åŒæ­¥
   - æ•°æ®æŒä¹…åŒ–å¯é 

---

## ğŸ“Š æŠ€æœ¯ç»†èŠ‚

### React çš„ Key æœºåˆ¶
React ä½¿ç”¨ `key` æ¥è¯†åˆ«åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚å½“ `key` æ”¹å˜æ—¶ï¼ŒReact è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæ–°å…ƒç´ ï¼Œä¼šé”€æ¯æ—§å…ƒç´ å¹¶åˆ›å»ºæ–°å…ƒç´ ã€‚

**é—®é¢˜åœºæ™¯**:
```tsx
// å½“ status ä» 'pending' å˜ä¸º 'published' æ—¶
rowKey={(record) => `${record.id}-${record.status}`}
// key ä» "assistant-1-pending" å˜ä¸º "assistant-1-published"
// React è®¤ä¸ºè¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„è¡Œï¼
```

**è§£å†³æ–¹æ¡ˆ**:
```tsx
// ä½¿ç”¨ä¸å˜çš„ id
rowKey="id"
// key å§‹ç»ˆæ˜¯ "assistant-1"
// React çŸ¥é“è¿™æ˜¯åŒä¸€è¡Œï¼Œåªæ˜¯çŠ¶æ€å˜äº†
```

### Promise å’Œ Loading çŠ¶æ€
```tsx
onOk: () => {
  setLoading(true);
  return new Promise((resolve) => {
    // æ‰§è¡Œæ“ä½œ
    updateAssistantStatus(record.id, 'published');
    
    // æ˜¾ç¤ºæ¶ˆæ¯
    message.success('æ“ä½œæˆåŠŸ', 2);
    
    // å»¶è¿Ÿåç»“æŸ loading
    setTimeout(() => {
      setLoading(false);
      resolve(true);
    }, 500);
  });
}
```

è¿™ä¸ªæ¨¡å¼ç¡®ä¿ï¼š
1. Modal åœ¨æ“ä½œå®Œæˆå‰ä¸ä¼šå…³é—­
2. ç”¨æˆ·çœ‹åˆ° loading çŠ¶æ€
3. æœ‰è¶³å¤Ÿæ—¶é—´çœ‹åˆ°æˆåŠŸæ¶ˆæ¯
4. UI æ›´æ–°å®Œæˆåæ‰ç»“æŸ loading

---

## ğŸ‰ æ€»ç»“

æ‰€æœ‰ bug å·²ä¿®å¤ï¼ç³»ç»Ÿç°åœ¨åº”è¯¥ï¼š
- âœ… åˆ›å»ºåŠ©ç†åç«‹å³å¯è§
- âœ… å®¡æ ¸æ“ä½œç«‹å³ç”Ÿæ•ˆ
- âœ… å¸‚åœºæ˜¾ç¤ºæ­£ç¡®
- âœ… æ‰€æœ‰æ“ä½œéƒ½æœ‰æ˜ç¡®åé¦ˆ
- âœ… è·¨æ ‡ç­¾é¡µå®æ—¶åŒæ­¥

**æ ¸å¿ƒä¿®å¤**: ç®€åŒ– Table rowKey + æ·»åŠ  Loading çŠ¶æ€ + ä¼˜åŒ– Context æ›´æ–°

**æµ‹è¯•**: è¯·æŒ‰ç…§ä¸Šé¢çš„æµ‹è¯•æ­¥éª¤éªŒè¯æ‰€æœ‰åŠŸèƒ½ï¼

---

**ä¿®å¤æ—¶é—´**: 2025-10-20  
**ä¿®å¤æ–‡ä»¶**: 2 ä¸ª  
**ä¿®å¤è¡Œæ•°**: ~50 è¡Œ  
**çŠ¶æ€**: âœ… å®Œæˆ

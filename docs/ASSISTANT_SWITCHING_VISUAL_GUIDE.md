# 助手切换功能视觉指南

## 功能概览

助手切换功能允许用户从助手市场激活助手后，立即切换到聊天界面开始对话。

---

## 用户流程

### 步骤 1: 浏览助手市场
```
┌─────────────────────────────────────────┐
│  助手市场                                │
├─────────────────────────────────────────┤
│                                          │
│  ┌──────────┐  ┌──────────┐            │
│  │ 🤖       │  │ 📝       │            │
│  │ 编程助手  │  │ 写作助手  │            │
│  │          │  │          │            │
│  └──────────┘  └──────────┘            │
│                                          │
│  ┌──────────┐  ┌──────────┐            │
│  │ 🎨       │  │ 📊       │            │
│  │ 设计助手  │  │ 数据分析  │  ← 点击查看 │
│  │          │  │          │            │
│  └──────────┘  └──────────┘            │
│                                          │
└─────────────────────────────────────────┘
```

### 步骤 2: 查看助手详情
```
┌─────────────────────────────────────────┐
│  📊 数据分析助手                         │
├─────────────────────────────────────────┤
│                                          │
│  专业的数据分析和可视化助手，帮助你     │
│  理解和呈现数据洞察。                   │
│                                          │
│  标签: #数据分析 #可视化 #统计          │
│                                          │
│  ┌─────────────────────────────────┐   │
│  │ 💬 使用该助手进行聊天            │ ← 点击 │
│  └─────────────────────────────────┘   │
│                                          │
└─────────────────────────────────────────┘
```

### 步骤 3: 添加成功对话框
```
┌─────────────────────────────────────────┐
│           ✅                             │
│                                          │
│      助手已添加成功！                    │
│                                          │
│  您现在可以在左侧助手列表中找到它       │
│                                          │
│  ┌─────────────────────────────────┐   │
│  │ 立即开始聊天                     │ ← 点击 │
│  └─────────────────────────────────┘   │
│                                          │
│  ┌─────────────────────────────────┐   │
│  │ 继续浏览                         │   │
│  └─────────────────────────────────┘   │
│                                          │
└─────────────────────────────────────────┘
```

### 步骤 4: 自动切换到聊天界面
```
┌──────────┬──────────────────────────────┐
│ 我的助手  │  📊 数据分析助手              │
├──────────┼──────────────────────────────┤
│          │                               │
│ 🤖 编程  │  💬 你好！我是数据分析助手。  │
│          │     我可以帮助你分析数据、    │
│ 📝 写作  │     创建可视化图表、进行      │
│          │     统计分析等。今天想分析    │
│ 📊 数据  │ ← 什么数据？                  │
│   分析   │                               │
│   (新)   │  ┌──────────────────────┐    │
│          │  │ 输入消息...           │    │
│          │  └──────────────────────┘    │
│          │                               │
└──────────┴──────────────────────────────┘
```

---

## 状态变化

### 激活按钮状态

#### 未添加状态
```
┌─────────────────────────────────┐
│ 💬 使用该助手进行聊天            │
└─────────────────────────────────┘
颜色: 主题蓝色
图标: 消息图标
可点击: 是
```

#### 添加中状态
```
┌─────────────────────────────────┐
│ ⏳ 添加中...                     │
└─────────────────────────────────┘
颜色: 主题蓝色
图标: 加载动画
可点击: 否
```

#### 已添加状态
```
┌─────────────────────────────────┐
│ ✅ 已添加                        │
└─────────────────────────────────┘
颜色: 成功绿色
图标: 对勾图标
可点击: 是（显示选项）
```

---

## 欢迎消息优先级

```
┌─────────────────────────────────────┐
│  欢迎消息来源优先级                  │
├─────────────────────────────────────┤
│                                      │
│  1️⃣ 自定义开场消息（最高）          │
│     ↓ 如果没有                      │
│                                      │
│  2️⃣ 助手的 Prompt                   │
│     ↓ 如果没有                      │
│                                      │
│  3️⃣ 预定义开场消息                  │
│     ↓ 如果没有                      │
│                                      │
│  4️⃣ 默认消息（最低）                │
│                                      │
└─────────────────────────────────────┘
```

### 示例

#### 使用助手 Prompt
```
助手 Prompt:
"我是一个专业的数据分析助手，擅长统计分析、
数据可视化和机器学习。我可以帮助你理解数据
背后的故事。"

显示的欢迎消息:
"我是一个专业的数据分析助手，擅长统计分析、
数据可视化和机器学习。我可以帮助你理解数据
背后的故事。"
```

#### Prompt 太长时截取
```
助手 Prompt:
"我是一个专业的数据分析助手，擅长统计分析、
数据可视化、机器学习、深度学习、自然语言处理、
计算机视觉等多个领域。我可以帮助你进行数据
清洗、特征工程、模型训练、模型评估等工作..."

显示的欢迎消息:
"我是一个专业的数据分析助手，擅长统计分析、
数据可视化、机器学习、深度学习、自然语言处理、
计算机视觉等多个领域。我可以帮助你进行数据..."
```

---

## 数据流

### LocalStorage 更新

#### 添加前
```json
{
  "user_assistants": [
    {
      "id": "assistant-1",
      "title": "编程助手",
      "addedAt": "2024-01-01T10:00:00Z",
      "lastUsedAt": "2024-01-02T15:30:00Z",
      "usageCount": 5
    }
  ]
}
```

#### 切换后
```json
{
  "user_assistants": [
    {
      "id": "assistant-1",
      "title": "编程助手",
      "addedAt": "2024-01-01T10:00:00Z",
      "lastUsedAt": "2024-01-02T15:30:00Z",
      "usageCount": 5
    },
    {
      "id": "assistant-2",
      "title": "数据分析助手",
      "addedAt": "2024-01-03T09:00:00Z",  ← 新添加
      "lastUsedAt": "2024-01-03T09:00:15Z", ← 立即更新
      "usageCount": 1                       ← 初始为 1
    }
  ]
}
```

---

## 事件时序图

```
时间轴 →

用户操作          组件状态                    系统事件
   │                 │                          │
   │ 点击激活按钮     │                          │
   ├────────────────→│                          │
   │                 │ isAdding = true          │
   │                 │                          │
   │                 │ 调用 addAssistant()      │
   │                 ├─────────────────────────→│
   │                 │                          │ 保存到 localStorage
   │                 │                          │
   │                 │←─────────────────────────┤
   │                 │ isAdded = true           │
   │                 │                          │
   │                 │ 显示成功对话框            │
   │                 │                          │
   │ 点击"立即聊天"   │                          │
   ├────────────────→│                          │
   │                 │ 触发 switchToAssistant   │
   │                 ├─────────────────────────→│
   │                 │                          │ ChatbotChat 接收
   │                 │                          │
   │                 │                          │ 查找助手
   │                 │                          │
   │                 │                          │ 更新 currentAssistant
   │                 │                          │
   │                 │                          │ 切换视图
   │                 │                          │
   │                 │                          │ 更新使用时间
   │                 │                          │
   │                 │                          │ 显示欢迎消息
   │                 │                          │
   │                 │←─────────────────────────┤
   │                 │ 显示聊天界面              │
   │                 │                          │
```

---

## 视觉反馈

### 按钮悬停效果
```
正常状态:
┌─────────────────────────────────┐
│ 💬 使用该助手进行聊天            │
└─────────────────────────────────┘

悬停状态:
┌─────────────────────────────────┐
│ 💬 使用该助手进行聊天            │ ↑ 向上移动 2px
└─────────────────────────────────┘
  阴影加深
```

### 点击涟漪效果
```
点击时:
┌─────────────────────────────────┐
│ 💬 使用该助手进行聊天            │
│         ⭕ ← 涟漪扩散            │
└─────────────────────────────────┘
```

### 助手列表高亮
```
┌──────────┐
│ 我的助手  │
├──────────┤
│          │
│ 🤖 编程  │
│          │
│ 📝 写作  │
│          │
│ ┏━━━━━━┓ │ ← 新添加的助手
│ ┃📊 数据┃ │   高亮显示 3 秒
│ ┃  分析 ┃ │   背景色: 主题色 10% 透明度
│ ┗━━━━━━┛ │   脉冲动画
│          │
└──────────┘
```

---

## 错误状态

### 助手不在列表中
```
控制台输出:
[ChatbotChat] Assistant not found in user list: assistant-123

用户看到:
（无变化，保持在当前界面）
```

### 更新使用时间失败
```
控制台输出:
[ChatbotChat] Failed to update last used time: QuotaExceededError

用户看到:
（正常切换，但使用时间未更新）
```

---

## 可访问性

### 键盘导航
```
Tab 键: 聚焦到激活按钮
  ↓
Enter/Space: 触发激活
  ↓
Tab 键: 聚焦到"立即聊天"按钮
  ↓
Enter: 切换到聊天界面
```

### 屏幕阅读器
```
激活按钮:
"点击将助手添加到列表并开始聊天"

添加中:
"正在添加助手到列表"

已添加:
"助手已添加，点击查看选项"

成功对话框:
"助手已添加成功！您现在可以在左侧助手列表中找到它"
```

---

## 性能指标

### 响应时间
```
┌─────────────────────────────────────┐
│  操作                    响应时间    │
├─────────────────────────────────────┤
│  点击激活按钮            < 50ms     │
│  添加到列表              < 100ms    │
│  显示成功对话框          < 50ms     │
│  触发切换事件            < 10ms     │
│  切换视图                < 100ms    │
│  显示欢迎消息            < 50ms     │
│  更新使用时间（异步）    不阻塞 UI   │
└─────────────────────────────────────┘
```

### 动画时长
```
┌─────────────────────────────────────┐
│  动画                    时长        │
├─────────────────────────────────────┤
│  按钮悬停效果            200ms      │
│  点击涟漪效果            600ms      │
│  对话框淡入              300ms      │
│  视图切换                240ms      │
│  助手高亮脉冲            1000ms × 3 │
└─────────────────────────────────────┘
```

---

## 总结

助手切换功能提供了流畅的用户体验：
- ✅ 一键激活助手
- ✅ 即时切换到聊天
- ✅ 智能欢迎消息
- ✅ 自动记录使用
- ✅ 完整的视觉反馈
- ✅ 良好的可访问性

用户可以在几秒钟内从浏览助手市场到开始对话，无需任何额外操作。
